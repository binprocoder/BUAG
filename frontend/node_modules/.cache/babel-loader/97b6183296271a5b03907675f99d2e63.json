{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Trang Tran\\\\Desktop\\\\Project M\\\\buag\\\\frontend\\\\src\\\\features\\\\teststripe\\\\Checkoutform.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport { useStripe, useElements, CardElement } from '@stripe/react-stripe-js';\nimport Cardinput from \"./CardInput\";\nimport stripeApi from '../../api/stripeApi';\nimport { message } from 'antd';\nimport \"./card.css\";\nimport { useDispatch, useSelector } from 'react-redux';\nimport { addhoadon, hoadonData } from '../container/admin/Hoadon/hoadonSlice';\nimport { useHistory } from 'react-router-dom';\nimport Axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function CheckoutForm(props) {\n  _s();\n\n  const [btn, setBtn] = useState(true);\n  const stripe = useStripe();\n  const elements = useElements();\n  const email = props.email;\n  const price = props.price * 100;\n  const hoadon = props.hoadon;\n  const tentour = props.tentour;\n  console.log(tentour);\n  const thanhtien = props.thanhtien;\n  const dispatch = useDispatch();\n  const history = useHistory();\n\n  const actionhoadon = async () => {\n    await dispatch(hoadonData());\n  };\n\n  const handleSubmit = async event => {\n    event.preventDefault();\n\n    if (!stripe || !elements) {\n      return;\n    }\n\n    console.log(\"ok\");\n    setBtn(false);\n    var res = await stripeApi.poststripe({\n      email,\n      price\n    }).then(ok => {\n      return ok.client_secret;\n    });\n    var clientSecret = res;\n    const result = await stripe.confirmCardPayment(clientSecret, {\n      payment_method: {\n        card: elements.getElement(CardElement),\n        billing_details: {\n          email: email\n        }\n      }\n    });\n\n    if (result.error) {\n      message.warning(\"Số thẻ hoặc thông tin khác không hợp lệ!\");\n    } else {\n      if (result.paymentIntent.status === 'succeeded') {\n        console.log(\"thanh cong\");\n        Axios.post(\"http://localhost:777/sendemail/\", {\n          thanhtien: thanhtien,\n          email: email,\n          tentour: tentour\n        });\n        message.success(\"Thanh toán thành công!\");\n        dispatch(addhoadon({\n          tourId: hoadon.tourId,\n          userId: hoadon.userId,\n          embe: hoadon.embe,\n          treem: hoadon.treem,\n          nguoilon: hoadon.nguoilon,\n          ngaydi: hoadon.ngaydi,\n          thanhtien: thanhtien\n        }));\n        actionhoadon();\n        history.push(`/tour/${hoadon.tourId}`);\n      }\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    onSubmit: handleSubmit,\n    children: [/*#__PURE__*/_jsxDEV(Cardinput, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 13\n    }, this), btn ? /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn-payment\",\n      disabled: !stripe,\n      children: \"Thanh to\\xE1n\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 17\n    }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn-payment ac\",\n      disabled: \"false\",\n      children: \"Thanh to\\xE1n\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 63,\n    columnNumber: 9\n  }, this);\n}\n\n_s(CheckoutForm, \"M2De1eN/disvVooK8Wuyh1UdwMI=\", false, function () {\n  return [useStripe, useElements, useDispatch, useHistory];\n});\n\n_c = CheckoutForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"CheckoutForm\");","map":{"version":3,"sources":["C:/Users/Trang Tran/Desktop/Project M/buag/frontend/src/features/teststripe/Checkoutform.js"],"names":["React","useState","useStripe","useElements","CardElement","Cardinput","stripeApi","message","useDispatch","useSelector","addhoadon","hoadonData","useHistory","Axios","CheckoutForm","props","btn","setBtn","stripe","elements","email","price","hoadon","tentour","console","log","thanhtien","dispatch","history","actionhoadon","handleSubmit","event","preventDefault","res","poststripe","then","ok","client_secret","clientSecret","result","confirmCardPayment","payment_method","card","getElement","billing_details","error","warning","paymentIntent","status","post","success","tourId","userId","embe","treem","nguoilon","ngaydi","push"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\r\nimport { useStripe, useElements, CardElement } from '@stripe/react-stripe-js';\r\nimport Cardinput from \"./CardInput\"\r\nimport stripeApi from '../../api/stripeApi';\r\nimport { message } from 'antd';\r\nimport \"./card.css\";\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { addhoadon, hoadonData } from '../container/admin/Hoadon/hoadonSlice';\r\nimport { useHistory } from 'react-router-dom';\r\nimport Axios from 'axios';\r\nexport default function CheckoutForm(props) {\r\n    const [btn, setBtn] = useState(true)\r\n    const stripe = useStripe();\r\n    const elements = useElements();\r\n    const email = props.email;\r\n    const price = props.price * 100;\r\n    const hoadon = props.hoadon;\r\n    const tentour = props.tentour;\r\n    console.log(tentour);\r\n    const thanhtien = props.thanhtien;\r\n    const dispatch = useDispatch();\r\n    const history = useHistory();\r\n    const actionhoadon = async () => { await dispatch(hoadonData()) }\r\n\r\n    const handleSubmit = async (event) => {\r\n        event.preventDefault()\r\n        if (!stripe || !elements) {\r\n            return;\r\n        }\r\n        console.log(\"ok\");\r\n        setBtn(false)\r\n        var res = await stripeApi.poststripe({ email, price }).then(ok => {\r\n            return ok.client_secret;\r\n        })\r\n        var clientSecret = res;\r\n        const result = await stripe.confirmCardPayment(clientSecret, {\r\n            payment_method: {\r\n                card: elements.getElement(CardElement),\r\n                billing_details: {\r\n                    email: email,\r\n                },\r\n            }\r\n        });\r\n        if (result.error) {\r\n            message.warning(\"Số thẻ hoặc thông tin khác không hợp lệ!\");\r\n        } else {\r\n            if (result.paymentIntent.status === 'succeeded') {\r\n                console.log(\"thanh cong\");\r\n                Axios.post(\"http://localhost:777/sendemail/\", {\r\n                    thanhtien: thanhtien,\r\n                    email: email,\r\n                    tentour: tentour\r\n                })\r\n                message.success(\"Thanh toán thành công!\");\r\n                dispatch(addhoadon({ tourId: hoadon.tourId, userId: hoadon.userId, embe: hoadon.embe, treem: hoadon.treem, nguoilon: hoadon.nguoilon, ngaydi: hoadon.ngaydi, thanhtien: thanhtien }));\r\n                actionhoadon();\r\n                history.push(`/tour/${hoadon.tourId}`);\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <form onSubmit={handleSubmit}>\r\n            <Cardinput />\r\n            {btn ?\r\n                <button className=\"btn-payment\" disabled={!stripe}>Thanh toán</button>\r\n                :\r\n                <button className=\"btn-payment ac\" disabled=\"false\">Thanh toán</button>\r\n            }\r\n        </form>\r\n    );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}