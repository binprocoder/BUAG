{"ast":null,"code":"'use strict'; // Translate the old options to the new Resolver functionality.\n\nconst fs = require('fs');\n\nconst pa = require('path');\n\nconst nmod = require('module');\n\nconst {\n  EventEmitter\n} = require('events');\n\nconst util = require('util');\n\nconst {\n  Resolver,\n  DefaultResolver\n} = require('./resolver');\n\nconst {\n  VMScript\n} = require('./script');\n\nconst {\n  VM\n} = require('./vm');\n\nconst {\n  VMError\n} = require('./bridge');\n/**\n * Require wrapper to be able to annotate require with webpackIgnore.\n *\n * @private\n * @param {string} moduleName - Name of module to load.\n * @return {*} Module exports.\n */\n\n\nfunction defaultRequire(moduleName) {\n  // Set module.parser.javascript.commonjsMagicComments=true in your webpack config.\n  // eslint-disable-next-line global-require\n  return require(\n  /* webpackIgnore: true */\n  moduleName);\n} // source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#Escaping\n\n\nfunction escapeRegExp(string) {\n  return string.replace(/[.*+\\-?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction makeExternalMatcherRegex(obj) {\n  return escapeRegExp(obj).replace(/\\\\\\\\|\\//g, '[\\\\\\\\/]').replace(/\\\\\\*\\\\\\*/g, '.*').replace(/\\\\\\*/g, '[^\\\\\\\\/]*').replace(/\\\\\\?/g, '[^\\\\\\\\/]');\n}\n\nfunction makeExternalMatcher(obj) {\n  const regexString = makeExternalMatcherRegex(obj);\n  return new RegExp(`[\\\\\\\\/]node_modules[\\\\\\\\/]${regexString}(?:[\\\\\\\\/](?!(?:.*[\\\\\\\\/])?node_modules[\\\\\\\\/]).*)?$`);\n}\n\nclass LegacyResolver extends DefaultResolver {\n  constructor(builtinModules, checkPath, globalPaths, pathContext, customResolver, hostRequire, compiler, externals, allowTransitive) {\n    super(builtinModules, checkPath, globalPaths, pathContext, customResolver, hostRequire, compiler);\n    this.externals = externals;\n    this.currMod = undefined;\n    this.trustedMods = new WeakMap();\n    this.allowTransitive = allowTransitive;\n  }\n\n  isPathAllowed(path) {\n    return this.isPathAllowedForModule(path, this.currMod);\n  }\n\n  isPathAllowedForModule(path, mod) {\n    if (!super.isPathAllowed(path)) return false;\n\n    if (mod) {\n      if (mod.allowTransitive) return true;\n\n      if (path.startsWith(mod.path)) {\n        const rem = path.slice(mod.path.length);\n        if (!/(?:^|[\\\\\\\\/])node_modules(?:$|[\\\\\\\\/])/.test(rem)) return true;\n      }\n    }\n\n    return this.externals.some(regex => regex.test(path));\n  }\n\n  registerModule(mod, filename, path, parent, direct) {\n    const trustedParent = this.trustedMods.get(parent);\n    this.trustedMods.set(mod, {\n      filename,\n      path,\n      paths: this.genLookupPaths(path),\n      allowTransitive: this.allowTransitive && (direct && trustedParent && trustedParent.allowTransitive || this.externals.some(regex => regex.test(filename)))\n    });\n  }\n\n  resolveFull(mod, x, options, ext, direct) {\n    this.currMod = undefined;\n    if (!direct) return super.resolveFull(mod, x, options, ext, false);\n    const trustedMod = this.trustedMods.get(mod);\n    if (!trustedMod || mod.path !== trustedMod.path) return super.resolveFull(mod, x, options, ext, false);\n    const paths = [...mod.paths];\n\n    if (paths.length === trustedMod.length) {\n      for (let i = 0; i < paths.length; i++) {\n        if (paths[i] !== trustedMod.paths[i]) {\n          return super.resolveFull(mod, x, options, ext, false);\n        }\n      }\n    }\n\n    const extCopy = Object.assign({\n      __proto__: null\n    }, ext);\n\n    try {\n      this.currMod = trustedMod;\n      return super.resolveFull(trustedMod, x, undefined, extCopy, true);\n    } finally {\n      this.currMod = undefined;\n    }\n  }\n\n  checkAccess(mod, filename) {\n    const trustedMod = this.trustedMods.get(mod);\n\n    if ((!trustedMod || trustedMod.filename !== filename) && !this.isPathAllowedForModule(filename, undefined)) {\n      throw new VMError(`Module '${filename}' is not allowed to be required. The path is outside the border!`, 'EDENIED');\n    }\n  }\n\n  loadJS(vm, mod, filename) {\n    filename = this.pathResolve(filename);\n    this.checkAccess(mod, filename);\n\n    if (this.pathContext(filename, 'js') === 'sandbox') {\n      const trustedMod = this.trustedMods.get(mod);\n      const script = this.readScript(filename);\n      vm.run(script, {\n        filename,\n        strict: true,\n        module: mod,\n        wrapper: 'none',\n        dirname: trustedMod ? trustedMod.path : mod.path\n      });\n    } else {\n      const m = this.hostRequire(filename);\n      mod.exports = vm.readonly(m);\n    }\n  }\n\n}\n\nfunction defaultBuiltinLoader(resolver, vm, id) {\n  const mod = resolver.hostRequire(id);\n  return vm.readonly(mod);\n}\n\nconst eventsModules = new WeakMap();\n\nfunction defaultBuiltinLoaderEvents(resolver, vm, id) {\n  return eventsModules.get(vm);\n}\n\nlet cacheBufferScript;\n\nfunction defaultBuiltinLoaderBuffer(resolver, vm, id) {\n  if (!cacheBufferScript) {\n    cacheBufferScript = new VMScript('return buffer=>({Buffer: buffer});', {\n      __proto__: null,\n      filename: 'buffer.js'\n    });\n  }\n\n  const makeBuffer = vm.run(cacheBufferScript, {\n    __proto__: null,\n    strict: true,\n    wrapper: 'none'\n  });\n  return makeBuffer(Buffer);\n}\n\nlet cacheUtilScript;\n\nfunction defaultBuiltinLoaderUtil(resolver, vm, id) {\n  if (!cacheUtilScript) {\n    cacheUtilScript = new VMScript(`return function inherits(ctor, superCtor) {\n\t\t\tctor.super_ = superCtor;\n\t\t\tObject.setPrototypeOf(ctor.prototype, superCtor.prototype);\n\t\t}`, {\n      __proto__: null,\n      filename: 'util.js'\n    });\n  }\n\n  const inherits = vm.run(cacheUtilScript, {\n    __proto__: null,\n    strict: true,\n    wrapper: 'none'\n  });\n  const copy = Object.assign({}, util);\n  copy.inherits = inherits;\n  return vm.readonly(copy);\n}\n\nconst BUILTIN_MODULES = (nmod.builtinModules || Object.getOwnPropertyNames(process.binding('natives'))).filter(s => !s.startsWith('internal/'));\nlet EventEmitterReferencingAsyncResourceClass = null;\n\nif (EventEmitter.EventEmitterAsyncResource) {\n  // eslint-disable-next-line global-require\n  const {\n    AsyncResource\n  } = require('async_hooks');\n\n  const kEventEmitter = Symbol('kEventEmitter');\n\n  class EventEmitterReferencingAsyncResource extends AsyncResource {\n    constructor(ee, type, options) {\n      super(type, options);\n      this[kEventEmitter] = ee;\n    }\n\n    get eventEmitter() {\n      return this[kEventEmitter];\n    }\n\n  }\n\n  EventEmitterReferencingAsyncResourceClass = EventEmitterReferencingAsyncResource;\n}\n\nlet cacheEventsScript;\nconst SPECIAL_MODULES = {\n  events(vm) {\n    if (!cacheEventsScript) {\n      const eventsSource = fs.readFileSync(`${__dirname}/events.js`, 'utf8');\n      cacheEventsScript = new VMScript(`(function (fromhost) { const module = {}; module.exports={};{ ${eventsSource}\n} return module.exports;})`, {\n        filename: 'events.js'\n      });\n    }\n\n    const closure = VM.prototype.run.call(vm, cacheEventsScript);\n    const eventsInstance = closure(vm.readonly({\n      kErrorMonitor: EventEmitter.errorMonitor,\n      once: EventEmitter.once,\n      on: EventEmitter.on,\n      getEventListeners: EventEmitter.getEventListeners,\n      EventEmitterReferencingAsyncResource: EventEmitterReferencingAsyncResourceClass\n    }));\n    eventsModules.set(vm, eventsInstance);\n\n    vm._addProtoMapping(EventEmitter.prototype, eventsInstance.EventEmitter.prototype);\n\n    return defaultBuiltinLoaderEvents;\n  },\n\n  buffer(vm) {\n    return defaultBuiltinLoaderBuffer;\n  },\n\n  util(vm) {\n    return defaultBuiltinLoaderUtil;\n  }\n\n};\n\nfunction addDefaultBuiltin(builtins, key, vm) {\n  if (builtins[key]) return;\n  const special = SPECIAL_MODULES[key];\n  builtins[key] = special ? special(vm) : defaultBuiltinLoader;\n}\n\nfunction genBuiltinsFromOptions(vm, builtinOpt, mockOpt, override) {\n  const builtins = {\n    __proto__: null\n  };\n\n  if (mockOpt) {\n    const keys = Object.getOwnPropertyNames(mockOpt);\n\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i];\n\n      builtins[key] = (resolver, tvm, id) => tvm.readonly(mockOpt[key]);\n    }\n  }\n\n  if (override) {\n    const keys = Object.getOwnPropertyNames(override);\n\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i];\n      builtins[key] = override[key];\n    }\n  }\n\n  if (Array.isArray(builtinOpt)) {\n    const def = builtinOpt.indexOf('*') >= 0;\n\n    if (def) {\n      for (let i = 0; i < BUILTIN_MODULES.length; i++) {\n        const name = BUILTIN_MODULES[i];\n\n        if (builtinOpt.indexOf(`-${name}`) === -1) {\n          addDefaultBuiltin(builtins, name, vm);\n        }\n      }\n    } else {\n      for (let i = 0; i < BUILTIN_MODULES.length; i++) {\n        const name = BUILTIN_MODULES[i];\n\n        if (builtinOpt.indexOf(name) !== -1) {\n          addDefaultBuiltin(builtins, name, vm);\n        }\n      }\n    }\n  } else if (builtinOpt) {\n    for (let i = 0; i < BUILTIN_MODULES.length; i++) {\n      const name = BUILTIN_MODULES[i];\n\n      if (builtinOpt[name]) {\n        addDefaultBuiltin(builtins, name, vm);\n      }\n    }\n  }\n\n  return builtins;\n}\n\nfunction defaultCustomResolver() {\n  return undefined;\n}\n\nconst DENY_RESOLVER = new Resolver({\n  __proto__: null\n}, [], id => {\n  throw new VMError(`Access denied to require '${id}'`, 'EDENIED');\n});\n\nfunction resolverFromOptions(vm, options, override, compiler) {\n  if (!options) {\n    if (!override) return DENY_RESOLVER;\n    const builtins = genBuiltinsFromOptions(vm, undefined, undefined, override);\n    return new Resolver(builtins, [], defaultRequire);\n  }\n\n  const {\n    builtin: builtinOpt,\n    mock: mockOpt,\n    external: externalOpt,\n    root: rootPaths,\n    resolve: customResolver,\n    customRequire: hostRequire = defaultRequire,\n    context = 'host'\n  } = options;\n  const builtins = genBuiltinsFromOptions(vm, builtinOpt, mockOpt, override);\n  if (!externalOpt) return new Resolver(builtins, [], hostRequire);\n  let checkPath;\n\n  if (rootPaths) {\n    const checkedRootPaths = (Array.isArray(rootPaths) ? rootPaths : [rootPaths]).map(f => pa.resolve(f));\n\n    checkPath = filename => {\n      return checkedRootPaths.some(path => {\n        if (!filename.startsWith(path)) return false;\n        const len = path.length;\n        if (filename.length === len || len > 0 && path[len - 1] === pa.sep) return true;\n        const sep = filename[len];\n        return sep === '/' || sep === pa.sep;\n      });\n    };\n  } else {\n    checkPath = () => true;\n  }\n\n  let newCustomResolver = defaultCustomResolver;\n  let externals = undefined;\n  let external = undefined;\n\n  if (customResolver) {\n    let externalCache;\n\n    newCustomResolver = (resolver, x, path, extList) => {\n      if (external && !(resolver.pathIsAbsolute(x) || resolver.pathIsRelative(x))) {\n        if (!externalCache) {\n          externalCache = external.map(ext => new RegExp(makeExternalMatcherRegex(ext)));\n        }\n\n        if (!externalCache.some(regex => regex.test(x))) return undefined;\n      }\n\n      const resolved = customResolver(x, path);\n      if (!resolved) return undefined;\n      if (externals) externals.push(new RegExp('^' + escapeRegExp(resolved)));\n      return resolver.loadAsFileOrDirecotry(resolved, extList);\n    };\n  }\n\n  if (typeof externalOpt !== 'object') {\n    return new DefaultResolver(builtins, checkPath, [], () => context, newCustomResolver, hostRequire, compiler);\n  }\n\n  let transitive = false;\n\n  if (Array.isArray(externalOpt)) {\n    external = externalOpt;\n  } else {\n    external = externalOpt.modules;\n    transitive = context === 'sandbox' && externalOpt.transitive;\n  }\n\n  externals = external.map(makeExternalMatcher);\n  return new LegacyResolver(builtins, checkPath, [], () => context, newCustomResolver, hostRequire, compiler, externals, transitive);\n}\n\nexports.resolverFromOptions = resolverFromOptions;","map":{"version":3,"sources":["C:/Users/Bin Tran/Desktop/BUAG/BUAG/frontend/node_modules/vm2/lib/resolver-compat.js"],"names":["fs","require","pa","nmod","EventEmitter","util","Resolver","DefaultResolver","VMScript","VM","VMError","defaultRequire","moduleName","escapeRegExp","string","replace","makeExternalMatcherRegex","obj","makeExternalMatcher","regexString","RegExp","LegacyResolver","constructor","builtinModules","checkPath","globalPaths","pathContext","customResolver","hostRequire","compiler","externals","allowTransitive","currMod","undefined","trustedMods","WeakMap","isPathAllowed","path","isPathAllowedForModule","mod","startsWith","rem","slice","length","test","some","regex","registerModule","filename","parent","direct","trustedParent","get","set","paths","genLookupPaths","resolveFull","x","options","ext","trustedMod","i","extCopy","Object","assign","__proto__","checkAccess","loadJS","vm","pathResolve","script","readScript","run","strict","module","wrapper","dirname","m","exports","readonly","defaultBuiltinLoader","resolver","id","eventsModules","defaultBuiltinLoaderEvents","cacheBufferScript","defaultBuiltinLoaderBuffer","makeBuffer","Buffer","cacheUtilScript","defaultBuiltinLoaderUtil","inherits","copy","BUILTIN_MODULES","getOwnPropertyNames","process","binding","filter","s","EventEmitterReferencingAsyncResourceClass","EventEmitterAsyncResource","AsyncResource","kEventEmitter","Symbol","EventEmitterReferencingAsyncResource","ee","type","eventEmitter","cacheEventsScript","SPECIAL_MODULES","events","eventsSource","readFileSync","__dirname","closure","prototype","call","eventsInstance","kErrorMonitor","errorMonitor","once","on","getEventListeners","_addProtoMapping","buffer","addDefaultBuiltin","builtins","key","special","genBuiltinsFromOptions","builtinOpt","mockOpt","override","keys","tvm","Array","isArray","def","indexOf","name","defaultCustomResolver","DENY_RESOLVER","resolverFromOptions","builtin","mock","external","externalOpt","root","rootPaths","resolve","customRequire","context","checkedRootPaths","map","f","len","sep","newCustomResolver","externalCache","extList","pathIsAbsolute","pathIsRelative","resolved","push","loadAsFileOrDirecotry","transitive","modules"],"mappings":"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","sourcesContent":["'use strict';\n\n// Translate the old options to the new Resolver functionality.\n\nconst fs = require('fs');\nconst pa = require('path');\nconst nmod = require('module');\nconst {EventEmitter} = require('events');\nconst util = require('util');\n\nconst {\n\tResolver,\n\tDefaultResolver\n} = require('./resolver');\nconst {VMScript} = require('./script');\nconst {VM} = require('./vm');\nconst {VMError} = require('./bridge');\n\n/**\n * Require wrapper to be able to annotate require with webpackIgnore.\n *\n * @private\n * @param {string} moduleName - Name of module to load.\n * @return {*} Module exports.\n */\nfunction defaultRequire(moduleName) {\n\t// Set module.parser.javascript.commonjsMagicComments=true in your webpack config.\n\t// eslint-disable-next-line global-require\n\treturn require(/* webpackIgnore: true */ moduleName);\n}\n\n// source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#Escaping\nfunction escapeRegExp(string) {\n\treturn string.replace(/[.*+\\-?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction makeExternalMatcherRegex(obj) {\n\treturn escapeRegExp(obj).replace(/\\\\\\\\|\\//g, '[\\\\\\\\/]')\n\t\t.replace(/\\\\\\*\\\\\\*/g, '.*').replace(/\\\\\\*/g, '[^\\\\\\\\/]*').replace(/\\\\\\?/g, '[^\\\\\\\\/]');\n}\n\nfunction makeExternalMatcher(obj) {\n\tconst regexString = makeExternalMatcherRegex(obj);\n\treturn new RegExp(`[\\\\\\\\/]node_modules[\\\\\\\\/]${regexString}(?:[\\\\\\\\/](?!(?:.*[\\\\\\\\/])?node_modules[\\\\\\\\/]).*)?$`);\n}\n\nclass LegacyResolver extends DefaultResolver {\n\n\tconstructor(builtinModules, checkPath, globalPaths, pathContext, customResolver, hostRequire, compiler, externals, allowTransitive) {\n\t\tsuper(builtinModules, checkPath, globalPaths, pathContext, customResolver, hostRequire, compiler);\n\t\tthis.externals = externals;\n\t\tthis.currMod = undefined;\n\t\tthis.trustedMods = new WeakMap();\n\t\tthis.allowTransitive = allowTransitive;\n\t}\n\n\tisPathAllowed(path) {\n\t\treturn this.isPathAllowedForModule(path, this.currMod);\n\t}\n\n\tisPathAllowedForModule(path, mod) {\n\t\tif (!super.isPathAllowed(path)) return false;\n\t\tif (mod) {\n\t\t\tif (mod.allowTransitive) return true;\n\t\t\tif (path.startsWith(mod.path)) {\n\t\t\t\tconst rem = path.slice(mod.path.length);\n\t\t\t\tif (!/(?:^|[\\\\\\\\/])node_modules(?:$|[\\\\\\\\/])/.test(rem)) return true;\n\t\t\t}\n\t\t}\n\t\treturn this.externals.some(regex => regex.test(path));\n\t}\n\n\tregisterModule(mod, filename, path, parent, direct) {\n\t\tconst trustedParent = this.trustedMods.get(parent);\n\t\tthis.trustedMods.set(mod, {\n\t\t\tfilename,\n\t\t\tpath,\n\t\t\tpaths: this.genLookupPaths(path),\n\t\t\tallowTransitive: this.allowTransitive &&\n\t\t\t\t((direct && trustedParent && trustedParent.allowTransitive) || this.externals.some(regex => regex.test(filename)))\n\t\t});\n\t}\n\n\tresolveFull(mod, x, options, ext, direct) {\n\t\tthis.currMod = undefined;\n\t\tif (!direct) return super.resolveFull(mod, x, options, ext, false);\n\t\tconst trustedMod = this.trustedMods.get(mod);\n\t\tif (!trustedMod || mod.path !== trustedMod.path) return super.resolveFull(mod, x, options, ext, false);\n\t\tconst paths = [...mod.paths];\n\t\tif (paths.length === trustedMod.length) {\n\t\t\tfor (let i = 0; i < paths.length; i++) {\n\t\t\t\tif (paths[i] !== trustedMod.paths[i]) {\n\t\t\t\t\treturn super.resolveFull(mod, x, options, ext, false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst extCopy = Object.assign({__proto__: null}, ext);\n\t\ttry {\n\t\t\tthis.currMod = trustedMod;\n\t\t\treturn super.resolveFull(trustedMod, x, undefined, extCopy, true);\n\t\t} finally {\n\t\t\tthis.currMod = undefined;\n\t\t}\n\t}\n\n\tcheckAccess(mod, filename) {\n\t\tconst trustedMod = this.trustedMods.get(mod);\n\t\tif ((!trustedMod || trustedMod.filename !== filename) && !this.isPathAllowedForModule(filename, undefined)) {\n\t\t\tthrow new VMError(`Module '${filename}' is not allowed to be required. The path is outside the border!`, 'EDENIED');\n\t\t}\n\t}\n\n\tloadJS(vm, mod, filename) {\n\t\tfilename = this.pathResolve(filename);\n\t\tthis.checkAccess(mod, filename);\n\t\tif (this.pathContext(filename, 'js') === 'sandbox') {\n\t\t\tconst trustedMod = this.trustedMods.get(mod);\n\t\t\tconst script = this.readScript(filename);\n\t\t\tvm.run(script, {filename, strict: true, module: mod, wrapper: 'none', dirname: trustedMod ? trustedMod.path : mod.path});\n\t\t} else {\n\t\t\tconst m = this.hostRequire(filename);\n\t\t\tmod.exports = vm.readonly(m);\n\t\t}\n\t}\n\n}\n\nfunction defaultBuiltinLoader(resolver, vm, id) {\n\tconst mod = resolver.hostRequire(id);\n\treturn vm.readonly(mod);\n}\n\nconst eventsModules = new WeakMap();\n\nfunction defaultBuiltinLoaderEvents(resolver, vm, id) {\n\treturn eventsModules.get(vm);\n}\n\nlet cacheBufferScript;\n\nfunction defaultBuiltinLoaderBuffer(resolver, vm, id) {\n\tif (!cacheBufferScript) {\n\t\tcacheBufferScript = new VMScript('return buffer=>({Buffer: buffer});', {__proto__: null, filename: 'buffer.js'});\n\t}\n\tconst makeBuffer = vm.run(cacheBufferScript, {__proto__: null, strict: true, wrapper: 'none'});\n\treturn makeBuffer(Buffer);\n}\n\nlet cacheUtilScript;\n\nfunction defaultBuiltinLoaderUtil(resolver, vm, id) {\n\tif (!cacheUtilScript) {\n\t\tcacheUtilScript = new VMScript(`return function inherits(ctor, superCtor) {\n\t\t\tctor.super_ = superCtor;\n\t\t\tObject.setPrototypeOf(ctor.prototype, superCtor.prototype);\n\t\t}`, {__proto__: null, filename: 'util.js'});\n\t}\n\tconst inherits = vm.run(cacheUtilScript, {__proto__: null, strict: true, wrapper: 'none'});\n\tconst copy = Object.assign({}, util);\n\tcopy.inherits = inherits;\n\treturn vm.readonly(copy);\n}\n\nconst BUILTIN_MODULES = (nmod.builtinModules || Object.getOwnPropertyNames(process.binding('natives'))).filter(s=>!s.startsWith('internal/'));\n\nlet EventEmitterReferencingAsyncResourceClass = null;\nif (EventEmitter.EventEmitterAsyncResource) {\n\t// eslint-disable-next-line global-require\n\tconst {AsyncResource} = require('async_hooks');\n\tconst kEventEmitter = Symbol('kEventEmitter');\n\tclass EventEmitterReferencingAsyncResource extends AsyncResource {\n\t\tconstructor(ee, type, options) {\n\t\t\tsuper(type, options);\n\t\t\tthis[kEventEmitter] = ee;\n\t\t}\n\t\tget eventEmitter() {\n\t\t\treturn this[kEventEmitter];\n\t\t}\n\t}\n\tEventEmitterReferencingAsyncResourceClass = EventEmitterReferencingAsyncResource;\n}\n\nlet cacheEventsScript;\n\nconst SPECIAL_MODULES = {\n\tevents(vm) {\n\t\tif (!cacheEventsScript) {\n\t\t\tconst eventsSource = fs.readFileSync(`${__dirname}/events.js`, 'utf8');\n\t\t\tcacheEventsScript = new VMScript(`(function (fromhost) { const module = {}; module.exports={};{ ${eventsSource}\n} return module.exports;})`, {filename: 'events.js'});\n\t\t}\n\t\tconst closure = VM.prototype.run.call(vm, cacheEventsScript);\n\t\tconst eventsInstance = closure(vm.readonly({\n\t\t\tkErrorMonitor: EventEmitter.errorMonitor,\n\t\t\tonce: EventEmitter.once,\n\t\t\ton: EventEmitter.on,\n\t\t\tgetEventListeners: EventEmitter.getEventListeners,\n\t\t\tEventEmitterReferencingAsyncResource: EventEmitterReferencingAsyncResourceClass\n\t\t}));\n\t\teventsModules.set(vm, eventsInstance);\n\t\tvm._addProtoMapping(EventEmitter.prototype, eventsInstance.EventEmitter.prototype);\n\t\treturn defaultBuiltinLoaderEvents;\n\t},\n\tbuffer(vm) {\n\t\treturn defaultBuiltinLoaderBuffer;\n\t},\n\tutil(vm) {\n\t\treturn defaultBuiltinLoaderUtil;\n\t}\n};\n\nfunction addDefaultBuiltin(builtins, key, vm) {\n\tif (builtins[key]) return;\n\tconst special = SPECIAL_MODULES[key];\n\tbuiltins[key] = special ? special(vm) : defaultBuiltinLoader;\n}\n\n\nfunction genBuiltinsFromOptions(vm, builtinOpt, mockOpt, override) {\n\tconst builtins = {__proto__: null};\n\tif (mockOpt) {\n\t\tconst keys = Object.getOwnPropertyNames(mockOpt);\n\t\tfor (let i = 0; i < keys.length; i++) {\n\t\t\tconst key = keys[i];\n\t\t\tbuiltins[key] = (resolver, tvm, id) => tvm.readonly(mockOpt[key]);\n\t\t}\n\t}\n\tif (override) {\n\t\tconst keys = Object.getOwnPropertyNames(override);\n\t\tfor (let i = 0; i < keys.length; i++) {\n\t\t\tconst key = keys[i];\n\t\t\tbuiltins[key] = override[key];\n\t\t}\n\t}\n\tif (Array.isArray(builtinOpt)) {\n\t\tconst def = builtinOpt.indexOf('*') >= 0;\n\t\tif (def) {\n\t\t\tfor (let i = 0; i < BUILTIN_MODULES.length; i++) {\n\t\t\t\tconst name = BUILTIN_MODULES[i];\n\t\t\t\tif (builtinOpt.indexOf(`-${name}`) === -1) {\n\t\t\t\t\taddDefaultBuiltin(builtins, name, vm);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let i = 0; i < BUILTIN_MODULES.length; i++) {\n\t\t\t\tconst name = BUILTIN_MODULES[i];\n\t\t\t\tif (builtinOpt.indexOf(name) !== -1) {\n\t\t\t\t\taddDefaultBuiltin(builtins, name, vm);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else if (builtinOpt) {\n\t\tfor (let i = 0; i < BUILTIN_MODULES.length; i++) {\n\t\t\tconst name = BUILTIN_MODULES[i];\n\t\t\tif (builtinOpt[name]) {\n\t\t\t\taddDefaultBuiltin(builtins, name, vm);\n\t\t\t}\n\t\t}\n\t}\n\treturn builtins;\n}\n\nfunction defaultCustomResolver() {\n\treturn undefined;\n}\n\nconst DENY_RESOLVER = new Resolver({__proto__: null}, [], id => {\n\tthrow new VMError(`Access denied to require '${id}'`, 'EDENIED');\n});\n\nfunction resolverFromOptions(vm, options, override, compiler) {\n\tif (!options) {\n\t\tif (!override) return DENY_RESOLVER;\n\t\tconst builtins = genBuiltinsFromOptions(vm, undefined, undefined, override);\n\t\treturn new Resolver(builtins, [], defaultRequire);\n\t}\n\n\tconst {\n\t\tbuiltin: builtinOpt,\n\t\tmock: mockOpt,\n\t\texternal: externalOpt,\n\t\troot: rootPaths,\n\t\tresolve: customResolver,\n\t\tcustomRequire: hostRequire = defaultRequire,\n\t\tcontext = 'host'\n\t} = options;\n\n\tconst builtins = genBuiltinsFromOptions(vm, builtinOpt, mockOpt, override);\n\n\tif (!externalOpt) return new Resolver(builtins, [], hostRequire);\n\n\tlet checkPath;\n\tif (rootPaths) {\n\t\tconst checkedRootPaths = (Array.isArray(rootPaths) ? rootPaths : [rootPaths]).map(f => pa.resolve(f));\n\t\tcheckPath = (filename) => {\n\t\t\treturn checkedRootPaths.some(path => {\n\t\t\t\tif (!filename.startsWith(path)) return false;\n\t\t\t\tconst len = path.length;\n\t\t\t\tif (filename.length === len || (len > 0 && path[len-1] === pa.sep)) return true;\n\t\t\t\tconst sep = filename[len];\n\t\t\t\treturn sep === '/' || sep === pa.sep;\n\t\t\t});\n\t\t};\n\t} else {\n\t\tcheckPath = () => true;\n\t}\n\n\tlet newCustomResolver = defaultCustomResolver;\n\tlet externals = undefined;\n\tlet external = undefined;\n\tif (customResolver) {\n\t\tlet externalCache;\n\t\tnewCustomResolver = (resolver, x, path, extList) => {\n\t\t\tif (external && !(resolver.pathIsAbsolute(x) || resolver.pathIsRelative(x))) {\n\t\t\t\tif (!externalCache) {\n\t\t\t\t\texternalCache = external.map(ext => new RegExp(makeExternalMatcherRegex(ext)));\n\t\t\t\t}\n\t\t\t\tif (!externalCache.some(regex => regex.test(x))) return undefined;\n\t\t\t}\n\t\t\tconst resolved = customResolver(x, path);\n\t\t\tif (!resolved) return undefined;\n\t\t\tif (externals) externals.push(new RegExp('^' + escapeRegExp(resolved)));\n\t\t\treturn resolver.loadAsFileOrDirecotry(resolved, extList);\n\t\t};\n\t}\n\n\tif (typeof externalOpt !== 'object') {\n\t\treturn new DefaultResolver(builtins, checkPath, [], () => context, newCustomResolver, hostRequire, compiler);\n\t}\n\n\tlet transitive = false;\n\tif (Array.isArray(externalOpt)) {\n\t\texternal = externalOpt;\n\t} else {\n\t\texternal = externalOpt.modules;\n\t\ttransitive = context === 'sandbox' && externalOpt.transitive;\n\t}\n\texternals = external.map(makeExternalMatcher);\n\treturn new LegacyResolver(builtins, checkPath, [], () => context, newCustomResolver, hostRequire, compiler, externals, transitive);\n}\n\nexports.resolverFromOptions = resolverFromOptions;\n"]},"metadata":{},"sourceType":"script"}