{"ast":null,"code":"'use strict';\n/**\n * __        ___    ____  _   _ ___ _   _  ____\n * \\ \\      / / \\  |  _ \\| \\ | |_ _| \\ | |/ ___|\n *  \\ \\ /\\ / / _ \\ | |_) |  \\| || ||  \\| | |  _\n *   \\ V  V / ___ \\|  _ <| |\\  || || |\\  | |_| |\n *    \\_/\\_/_/   \\_\\_| \\_\\_| \\_|___|_| \\_|\\____|\n *\n * This file is critical for vm2. It implements the bridge between the host and the sandbox.\n * If you do not know exactly what you are doing, you should NOT edit this file.\n *\n * The file is loaded in the host and sandbox to handle objects in both directions.\n * This is done to ensure that RangeErrors are from the correct context.\n * The boundary between the sandbox and host might throw RangeErrors from both contexts.\n * Therefore, thisFromOther and friends can handle objects from both domains.\n *\n * Method parameters have comments to tell from which context they came.\n *\n */\n\nconst globalsList = ['Number', 'String', 'Boolean', 'Date', 'RegExp', 'Map', 'WeakMap', 'Set', 'WeakSet', 'Promise', 'Function'];\nconst errorsList = ['RangeError', 'ReferenceError', 'SyntaxError', 'TypeError', 'EvalError', 'URIError', 'Error'];\nconst OPNA = 'Operation not allowed on contextified object.';\nconst thisGlobalPrototypes = {\n  __proto__: null,\n  Object: Object.prototype,\n  Array: Array.prototype\n};\n\nfor (let i = 0; i < globalsList.length; i++) {\n  const key = globalsList[i];\n  const g = global[key];\n  if (g) thisGlobalPrototypes[key] = g.prototype;\n}\n\nfor (let i = 0; i < errorsList.length; i++) {\n  const key = errorsList[i];\n  const g = global[key];\n  if (g) thisGlobalPrototypes[key] = g.prototype;\n}\n\nconst {\n  getPrototypeOf: thisReflectGetPrototypeOf,\n  setPrototypeOf: thisReflectSetPrototypeOf,\n  defineProperty: thisReflectDefineProperty,\n  deleteProperty: thisReflectDeleteProperty,\n  getOwnPropertyDescriptor: thisReflectGetOwnPropertyDescriptor,\n  isExtensible: thisReflectIsExtensible,\n  preventExtensions: thisReflectPreventExtensions,\n  apply: thisReflectApply,\n  construct: thisReflectConstruct,\n  set: thisReflectSet,\n  get: thisReflectGet,\n  has: thisReflectHas,\n  ownKeys: thisReflectOwnKeys,\n  enumerate: thisReflectEnumerate\n} = Reflect;\nconst thisObject = Object;\nconst {\n  freeze: thisObjectFreeze,\n  prototype: thisObjectPrototype\n} = thisObject;\nconst thisObjectHasOwnProperty = thisObjectPrototype.hasOwnProperty;\nconst ThisProxy = Proxy;\nconst ThisWeakMap = WeakMap;\nconst {\n  get: thisWeakMapGet,\n  set: thisWeakMapSet\n} = ThisWeakMap.prototype;\nconst ThisMap = Map;\nconst thisMapGet = ThisMap.prototype.get;\nconst thisMapSet = ThisMap.prototype.set;\nconst thisFunction = Function;\nconst thisFunctionBind = thisFunction.prototype.bind;\nconst thisArrayIsArray = Array.isArray;\nconst thisErrorCaptureStackTrace = Error.captureStackTrace;\nconst thisSymbolToString = Symbol.prototype.toString;\nconst thisSymbolToStringTag = Symbol.toStringTag;\n/**\n * VMError.\n *\n * @public\n * @extends {Error}\n */\n\nclass VMError extends Error {\n  /**\n   * Create VMError instance.\n   *\n   * @public\n   * @param {string} message - Error message.\n   * @param {string} code - Error code.\n   */\n  constructor(message, code) {\n    super(message);\n    this.name = 'VMError';\n    this.code = code;\n    thisErrorCaptureStackTrace(this, this.constructor);\n  }\n\n}\n\nthisGlobalPrototypes['VMError'] = VMError.prototype;\n\nfunction thisUnexpected() {\n  return new VMError('Unexpected');\n}\n\nif (!thisReflectSetPrototypeOf(exports, null)) throw thisUnexpected();\n\nfunction thisSafeGetOwnPropertyDescriptor(obj, key) {\n  const desc = thisReflectGetOwnPropertyDescriptor(obj, key);\n  if (!desc) return desc;\n  if (!thisReflectSetPrototypeOf(desc, null)) throw thisUnexpected();\n  return desc;\n}\n\nfunction thisThrowCallerCalleeArgumentsAccess(key) {\n  'use strict';\n\n  thisThrowCallerCalleeArgumentsAccess[key];\n  return thisUnexpected();\n}\n\nfunction thisIdMapping(factory, other) {\n  return other;\n}\n\nconst thisThrowOnKeyAccessHandler = thisObjectFreeze({\n  __proto__: null,\n\n  get(target, key, receiver) {\n    if (typeof key === 'symbol') {\n      key = thisReflectApply(thisSymbolToString, key, []);\n    }\n\n    throw new VMError(`Unexpected access to key '${key}'`);\n  }\n\n});\nconst emptyForzenObject = thisObjectFreeze({\n  __proto__: null\n});\nconst thisThrowOnKeyAccess = new ThisProxy(emptyForzenObject, thisThrowOnKeyAccessHandler);\n\nfunction SafeBase() {}\n\nif (!thisReflectDefineProperty(SafeBase, 'prototype', {\n  __proto__: null,\n  value: thisThrowOnKeyAccess\n})) throw thisUnexpected();\n\nfunction SHARED_FUNCTION() {}\n\nconst TEST_PROXY_HANDLER = thisObjectFreeze({\n  __proto__: thisThrowOnKeyAccess,\n\n  construct() {\n    return this;\n  }\n\n});\n\nfunction thisIsConstructor(obj) {\n  // Note: obj@any(unsafe)\n  const Func = new ThisProxy(obj, TEST_PROXY_HANDLER);\n\n  try {\n    // eslint-disable-next-line no-new\n    new Func();\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction thisCreateTargetObject(obj, proto) {\n  // Note: obj@any(unsafe) proto@any(unsafe) returns@this(unsafe) throws@this(unsafe)\n  let base;\n\n  if (typeof obj === 'function') {\n    if (thisIsConstructor(obj)) {\n      // Bind the function since bound functions do not have a prototype property.\n      base = thisReflectApply(thisFunctionBind, SHARED_FUNCTION, [null]);\n    } else {\n      base = () => {};\n    }\n  } else if (thisArrayIsArray(obj)) {\n    base = [];\n  } else {\n    return {\n      __proto__: proto\n    };\n  }\n\n  if (!thisReflectSetPrototypeOf(base, proto)) throw thisUnexpected();\n  return base;\n}\n\nfunction createBridge(otherInit, registerProxy) {\n  const mappingOtherToThis = new ThisWeakMap();\n  const protoMappings = new ThisMap();\n  const protoName = new ThisMap();\n\n  function thisAddProtoMapping(proto, other, name) {\n    // Note: proto@this(unsafe) other@other(unsafe) name@this(unsafe) throws@this(unsafe)\n    thisReflectApply(thisMapSet, protoMappings, [proto, thisIdMapping]);\n    thisReflectApply(thisMapSet, protoMappings, [other, (factory, object) => thisProxyOther(factory, object, proto)]);\n    if (name) thisReflectApply(thisMapSet, protoName, [proto, name]);\n  }\n\n  function thisAddProtoMappingFactory(protoFactory, other, name) {\n    // Note: protoFactory@this(unsafe) other@other(unsafe) name@this(unsafe) throws@this(unsafe)\n    let proto;\n    thisReflectApply(thisMapSet, protoMappings, [other, (factory, object) => {\n      if (!proto) {\n        proto = protoFactory();\n        thisReflectApply(thisMapSet, protoMappings, [proto, thisIdMapping]);\n        if (name) thisReflectApply(thisMapSet, protoName, [proto, name]);\n      }\n\n      return thisProxyOther(factory, object, proto);\n    }]);\n  }\n\n  const result = {\n    __proto__: null,\n    globalPrototypes: thisGlobalPrototypes,\n    safeGetOwnPropertyDescriptor: thisSafeGetOwnPropertyDescriptor,\n    fromArguments: thisFromOtherArguments,\n    from: thisFromOther,\n    fromWithFactory: thisFromOtherWithFactory,\n    ensureThis: thisEnsureThis,\n    mapping: mappingOtherToThis,\n    connect: thisConnect,\n    reflectSet: thisReflectSet,\n    reflectGet: thisReflectGet,\n    reflectDefineProperty: thisReflectDefineProperty,\n    reflectDeleteProperty: thisReflectDeleteProperty,\n    reflectApply: thisReflectApply,\n    reflectConstruct: thisReflectConstruct,\n    reflectHas: thisReflectHas,\n    reflectOwnKeys: thisReflectOwnKeys,\n    reflectEnumerate: thisReflectEnumerate,\n    reflectGetPrototypeOf: thisReflectGetPrototypeOf,\n    reflectIsExtensible: thisReflectIsExtensible,\n    reflectPreventExtensions: thisReflectPreventExtensions,\n    objectHasOwnProperty: thisObjectHasOwnProperty,\n    weakMapSet: thisWeakMapSet,\n    addProtoMapping: thisAddProtoMapping,\n    addProtoMappingFactory: thisAddProtoMappingFactory,\n    defaultFactory,\n    protectedFactory,\n    readonlyFactory,\n    VMError\n  };\n  const isHost = typeof otherInit !== 'object';\n\n  if (isHost) {\n    otherInit = otherInit(result, registerProxy);\n  }\n\n  result.other = otherInit;\n  const {\n    globalPrototypes: otherGlobalPrototypes,\n    safeGetOwnPropertyDescriptor: otherSafeGetOwnPropertyDescriptor,\n    fromArguments: otherFromThisArguments,\n    from: otherFromThis,\n    mapping: mappingThisToOther,\n    reflectSet: otherReflectSet,\n    reflectGet: otherReflectGet,\n    reflectDefineProperty: otherReflectDefineProperty,\n    reflectDeleteProperty: otherReflectDeleteProperty,\n    reflectApply: otherReflectApply,\n    reflectConstruct: otherReflectConstruct,\n    reflectHas: otherReflectHas,\n    reflectOwnKeys: otherReflectOwnKeys,\n    reflectEnumerate: otherReflectEnumerate,\n    reflectGetPrototypeOf: otherReflectGetPrototypeOf,\n    reflectIsExtensible: otherReflectIsExtensible,\n    reflectPreventExtensions: otherReflectPreventExtensions,\n    objectHasOwnProperty: otherObjectHasOwnProperty,\n    weakMapSet: otherWeakMapSet\n  } = otherInit;\n\n  function thisOtherHasOwnProperty(object, key) {\n    // Note: object@other(safe) key@prim throws@this(unsafe)\n    try {\n      return otherReflectApply(otherObjectHasOwnProperty, object, [key]) === true;\n    } catch (e) {\n      // @other(unsafe)\n      throw thisFromOtherForThrow(e);\n    }\n  }\n\n  function thisDefaultGet(handler, object, key, desc) {\n    // Note: object@other(unsafe) key@prim desc@other(safe)\n    let ret; // @other(unsafe)\n\n    if (desc.get || desc.set) {\n      const getter = desc.get;\n      if (!getter) return undefined;\n\n      try {\n        ret = otherReflectApply(getter, object, [key]);\n      } catch (e) {\n        throw thisFromOtherForThrow(e);\n      }\n    } else {\n      ret = desc.value;\n    }\n\n    return handler.fromOtherWithContext(ret);\n  }\n\n  function otherFromThisIfAvailable(to, from, key) {\n    // Note: to@other(safe) from@this(safe) key@prim throws@this(unsafe)\n    if (!thisReflectApply(thisObjectHasOwnProperty, from, [key])) return false;\n\n    try {\n      to[key] = otherFromThis(from[key]);\n    } catch (e) {\n      // @other(unsafe)\n      throw thisFromOtherForThrow(e);\n    }\n\n    return true;\n  }\n\n  class BaseHandler extends SafeBase {\n    constructor(object) {\n      // Note: object@other(unsafe) throws@this(unsafe)\n      super();\n      this.object = object;\n    }\n\n    getFactory() {\n      return defaultFactory;\n    }\n\n    fromOtherWithContext(other) {\n      // Note: other@other(unsafe) throws@this(unsafe)\n      return thisFromOtherWithFactory(this.getFactory(), other);\n    }\n\n    doPreventExtensions(target, object, factory) {\n      // Note: target@this(unsafe) object@other(unsafe) throws@this(unsafe)\n      let keys; // @other(safe-array-of-prim)\n\n      try {\n        keys = otherReflectOwnKeys(object);\n      } catch (e) {\n        // @other(unsafe)\n        throw thisFromOtherForThrow(e);\n      }\n\n      for (let i = 0; i < keys.length; i++) {\n        const key = keys[i]; // @prim\n\n        let desc;\n\n        try {\n          desc = otherSafeGetOwnPropertyDescriptor(object, key);\n        } catch (e) {\n          // @other(unsafe)\n          throw thisFromOtherForThrow(e);\n        }\n\n        if (!desc) continue;\n\n        if (!desc.configurable) {\n          const current = thisSafeGetOwnPropertyDescriptor(target, key);\n          if (current && !current.configurable) continue;\n\n          if (desc.get || desc.set) {\n            desc.get = this.fromOtherWithContext(desc.get);\n            desc.set = this.fromOtherWithContext(desc.set);\n          } else if (typeof object === 'function' && (key === 'caller' || key === 'callee' || key === 'arguments')) {\n            desc.value = null;\n          } else {\n            desc.value = this.fromOtherWithContext(desc.value);\n          }\n        } else {\n          if (desc.get || desc.set) {\n            desc = {\n              __proto__: null,\n              configurable: true,\n              enumerable: desc.enumerable,\n              writable: true,\n              value: null\n            };\n          } else {\n            desc.value = null;\n          }\n        }\n\n        if (!thisReflectDefineProperty(target, key, desc)) throw thisUnexpected();\n      }\n\n      if (!thisReflectPreventExtensions(target)) throw thisUnexpected();\n    }\n\n    get(target, key, receiver) {\n      // Note: target@this(unsafe) key@prim receiver@this(unsafe) throws@this(unsafe)\n      const object = this.object; // @other(unsafe)\n\n      switch (key) {\n        case 'constructor':\n          {\n            const desc = otherSafeGetOwnPropertyDescriptor(object, key);\n            if (desc) return thisDefaultGet(this, object, key, desc);\n            const proto = thisReflectGetPrototypeOf(target);\n            return proto === null ? undefined : proto.constructor;\n          }\n\n        case '__proto__':\n          {\n            const desc = otherSafeGetOwnPropertyDescriptor(object, key);\n            if (desc) return thisDefaultGet(this, object, key, desc);\n            return thisReflectGetPrototypeOf(target);\n          }\n\n        case thisSymbolToStringTag:\n          if (!thisOtherHasOwnProperty(object, thisSymbolToStringTag)) {\n            const proto = thisReflectGetPrototypeOf(target);\n            const name = thisReflectApply(thisMapGet, protoName, [proto]);\n            if (name) return name;\n          }\n\n          break;\n\n        case 'arguments':\n        case 'caller':\n        case 'callee':\n          if (typeof object === 'function' && thisOtherHasOwnProperty(object, key)) {\n            throw thisThrowCallerCalleeArgumentsAccess(key);\n          }\n\n          break;\n      }\n\n      let ret; // @other(unsafe)\n\n      try {\n        ret = otherReflectGet(object, key);\n      } catch (e) {\n        // @other(unsafe)\n        throw thisFromOtherForThrow(e);\n      }\n\n      return this.fromOtherWithContext(ret);\n    }\n\n    set(target, key, value, receiver) {\n      // Note: target@this(unsafe) key@prim value@this(unsafe) receiver@this(unsafe) throws@this(unsafe)\n      const object = this.object; // @other(unsafe)\n\n      if (key === '__proto__' && !thisOtherHasOwnProperty(object, key)) {\n        return this.setPrototypeOf(target, value);\n      }\n\n      try {\n        value = otherFromThis(value);\n        return otherReflectSet(object, key, value) === true;\n      } catch (e) {\n        // @other(unsafe)\n        throw thisFromOtherForThrow(e);\n      }\n    }\n\n    getPrototypeOf(target) {\n      // Note: target@this(unsafe)\n      return thisReflectGetPrototypeOf(target);\n    }\n\n    setPrototypeOf(target, value) {\n      // Note: target@this(unsafe) throws@this(unsafe)\n      throw new VMError(OPNA);\n    }\n\n    apply(target, context, args) {\n      // Note: target@this(unsafe) context@this(unsafe) args@this(safe-array) throws@this(unsafe)\n      const object = this.object; // @other(unsafe)\n\n      let ret; // @other(unsafe)\n\n      try {\n        context = otherFromThis(context);\n        args = otherFromThisArguments(args);\n        ret = otherReflectApply(object, context, args);\n      } catch (e) {\n        // @other(unsafe)\n        throw thisFromOtherForThrow(e);\n      }\n\n      return thisFromOther(ret);\n    }\n\n    construct(target, args, newTarget) {\n      // Note: target@this(unsafe) args@this(safe-array) newTarget@this(unsafe) throws@this(unsafe)\n      const object = this.object; // @other(unsafe)\n\n      let ret; // @other(unsafe)\n\n      try {\n        args = otherFromThisArguments(args);\n        ret = otherReflectConstruct(object, args);\n      } catch (e) {\n        // @other(unsafe)\n        throw thisFromOtherForThrow(e);\n      }\n\n      return thisFromOtherWithFactory(this.getFactory(), ret, thisFromOther(object));\n    }\n\n    getOwnPropertyDescriptorDesc(target, prop, desc) {\n      // Note: target@this(unsafe) prop@prim desc@other{safe} throws@this(unsafe)\n      const object = this.object; // @other(unsafe)\n\n      if (desc && typeof object === 'function' && (prop === 'arguments' || prop === 'caller' || prop === 'callee')) desc.value = null;\n      return desc;\n    }\n\n    getOwnPropertyDescriptor(target, prop) {\n      // Note: target@this(unsafe) prop@prim throws@this(unsafe)\n      const object = this.object; // @other(unsafe)\n\n      let desc; // @other(safe)\n\n      try {\n        desc = otherSafeGetOwnPropertyDescriptor(object, prop);\n      } catch (e) {\n        // @other(unsafe)\n        throw thisFromOtherForThrow(e);\n      }\n\n      desc = this.getOwnPropertyDescriptorDesc(target, prop, desc);\n      if (!desc) return undefined;\n      let thisDesc;\n\n      if (desc.get || desc.set) {\n        thisDesc = {\n          __proto__: null,\n          get: this.fromOtherWithContext(desc.get),\n          set: this.fromOtherWithContext(desc.set),\n          enumerable: desc.enumerable === true,\n          configurable: desc.configurable === true\n        };\n      } else {\n        thisDesc = {\n          __proto__: null,\n          value: this.fromOtherWithContext(desc.value),\n          writable: desc.writable === true,\n          enumerable: desc.enumerable === true,\n          configurable: desc.configurable === true\n        };\n      }\n\n      if (!thisDesc.configurable) {\n        const oldDesc = thisSafeGetOwnPropertyDescriptor(target, prop);\n\n        if (!oldDesc || oldDesc.configurable || oldDesc.writable !== thisDesc.writable) {\n          if (!thisReflectDefineProperty(target, prop, thisDesc)) throw thisUnexpected();\n        }\n      }\n\n      return thisDesc;\n    }\n\n    definePropertyDesc(target, prop, desc) {\n      // Note: target@this(unsafe) prop@prim desc@this(safe) throws@this(unsafe)\n      return desc;\n    }\n\n    defineProperty(target, prop, desc) {\n      // Note: target@this(unsafe) prop@prim desc@this(unsafe) throws@this(unsafe)\n      const object = this.object; // @other(unsafe)\n\n      if (!thisReflectSetPrototypeOf(desc, null)) throw thisUnexpected();\n      desc = this.definePropertyDesc(target, prop, desc);\n      if (!desc) return false;\n      let otherDesc = {\n        __proto__: null\n      };\n      let hasFunc = true;\n      let hasValue = true;\n      let hasBasic = true;\n      hasFunc &= otherFromThisIfAvailable(otherDesc, desc, 'get');\n      hasFunc &= otherFromThisIfAvailable(otherDesc, desc, 'set');\n      hasValue &= otherFromThisIfAvailable(otherDesc, desc, 'value');\n      hasValue &= otherFromThisIfAvailable(otherDesc, desc, 'writable');\n      hasBasic &= otherFromThisIfAvailable(otherDesc, desc, 'enumerable');\n      hasBasic &= otherFromThisIfAvailable(otherDesc, desc, 'configurable');\n\n      try {\n        if (!otherReflectDefineProperty(object, prop, otherDesc)) return false;\n\n        if (otherDesc.configurable !== true && (!hasBasic || !(hasFunc || hasValue))) {\n          otherDesc = otherSafeGetOwnPropertyDescriptor(object, prop);\n        }\n      } catch (e) {\n        // @other(unsafe)\n        throw thisFromOtherForThrow(e);\n      }\n\n      if (!otherDesc.configurable) {\n        let thisDesc;\n\n        if (otherDesc.get || otherDesc.set) {\n          thisDesc = {\n            __proto__: null,\n            get: this.fromOtherWithContext(otherDesc.get),\n            set: this.fromOtherWithContext(otherDesc.set),\n            enumerable: otherDesc.enumerable,\n            configurable: otherDesc.configurable\n          };\n        } else {\n          thisDesc = {\n            __proto__: null,\n            value: this.fromOtherWithContext(otherDesc.value),\n            writable: otherDesc.writable,\n            enumerable: otherDesc.enumerable,\n            configurable: otherDesc.configurable\n          };\n        }\n\n        if (!thisReflectDefineProperty(target, prop, thisDesc)) throw thisUnexpected();\n      }\n\n      return true;\n    }\n\n    deleteProperty(target, prop) {\n      // Note: target@this(unsafe) prop@prim throws@this(unsafe)\n      const object = this.object; // @other(unsafe)\n\n      try {\n        return otherReflectDeleteProperty(object, prop) === true;\n      } catch (e) {\n        // @other(unsafe)\n        throw thisFromOtherForThrow(e);\n      }\n    }\n\n    has(target, key) {\n      // Note: target@this(unsafe) key@prim throws@this(unsafe)\n      const object = this.object; // @other(unsafe)\n\n      try {\n        return otherReflectHas(object, key) === true;\n      } catch (e) {\n        // @other(unsafe)\n        throw thisFromOtherForThrow(e);\n      }\n    }\n\n    isExtensible(target) {\n      // Note: target@this(unsafe) throws@this(unsafe)\n      const object = this.object; // @other(unsafe)\n\n      try {\n        if (otherReflectIsExtensible(object)) return true;\n      } catch (e) {\n        // @other(unsafe)\n        throw thisFromOtherForThrow(e);\n      }\n\n      if (thisReflectIsExtensible(target)) {\n        this.doPreventExtensions(target, object, this);\n      }\n\n      return false;\n    }\n\n    ownKeys(target) {\n      // Note: target@this(unsafe) throws@this(unsafe)\n      const object = this.object; // @other(unsafe)\n\n      let res; // @other(unsafe)\n\n      try {\n        res = otherReflectOwnKeys(object);\n      } catch (e) {\n        // @other(unsafe)\n        throw thisFromOtherForThrow(e);\n      }\n\n      return thisFromOther(res);\n    }\n\n    preventExtensions(target) {\n      // Note: target@this(unsafe) throws@this(unsafe)\n      const object = this.object; // @other(unsafe)\n\n      try {\n        if (!otherReflectPreventExtensions(object)) return false;\n      } catch (e) {\n        // @other(unsafe)\n        throw thisFromOtherForThrow(e);\n      }\n\n      if (thisReflectIsExtensible(target)) {\n        this.doPreventExtensions(target, object, this);\n      }\n\n      return true;\n    }\n\n    enumerate(target) {\n      // Note: target@this(unsafe) throws@this(unsafe)\n      const object = this.object; // @other(unsafe)\n\n      let res; // @other(unsafe)\n\n      try {\n        res = otherReflectEnumerate(object);\n      } catch (e) {\n        // @other(unsafe)\n        throw thisFromOtherForThrow(e);\n      }\n\n      return this.fromOtherWithContext(res);\n    }\n\n  }\n\n  function defaultFactory(object) {\n    // Note: other@other(unsafe) returns@this(unsafe) throws@this(unsafe)\n    return new BaseHandler(object);\n  }\n\n  class ProtectedHandler extends BaseHandler {\n    getFactory() {\n      return protectedFactory;\n    }\n\n    set(target, key, value, receiver) {\n      // Note: target@this(unsafe) key@prim value@this(unsafe) receiver@this(unsafe) throws@this(unsafe)\n      if (typeof value === 'function') {\n        return thisReflectDefineProperty(receiver, key, {\n          __proto__: null,\n          value: value,\n          writable: true,\n          enumerable: true,\n          configurable: true\n        }) === true;\n      }\n\n      return super.set(target, key, value, receiver);\n    }\n\n    definePropertyDesc(target, prop, desc) {\n      // Note: target@this(unsafe) prop@prim desc@this(safe) throws@this(unsafe)\n      if (desc && (desc.set || desc.get || typeof desc.value === 'function')) return undefined;\n      return desc;\n    }\n\n  }\n\n  function protectedFactory(object) {\n    // Note: other@other(unsafe) returns@this(unsafe) throws@this(unsafe)\n    return new ProtectedHandler(object);\n  }\n\n  class ReadOnlyHandler extends BaseHandler {\n    getFactory() {\n      return readonlyFactory;\n    }\n\n    set(target, key, value, receiver) {\n      // Note: target@this(unsafe) key@prim value@this(unsafe) receiver@this(unsafe) throws@this(unsafe)\n      return thisReflectDefineProperty(receiver, key, {\n        __proto__: null,\n        value: value,\n        writable: true,\n        enumerable: true,\n        configurable: true\n      });\n    }\n\n    setPrototypeOf(target, value) {\n      // Note: target@this(unsafe) throws@this(unsafe)\n      return false;\n    }\n\n    defineProperty(target, prop, desc) {\n      // Note: target@this(unsafe) prop@prim desc@this(unsafe) throws@this(unsafe)\n      return false;\n    }\n\n    deleteProperty(target, prop) {\n      // Note: target@this(unsafe) prop@prim throws@this(unsafe)\n      return false;\n    }\n\n    isExtensible(target) {\n      // Note: target@this(unsafe) throws@this(unsafe)\n      return false;\n    }\n\n    preventExtensions(target) {\n      // Note: target@this(unsafe) throws@this(unsafe)\n      return false;\n    }\n\n  }\n\n  function readonlyFactory(object) {\n    // Note: other@other(unsafe) returns@this(unsafe) throws@this(unsafe)\n    return new ReadOnlyHandler(object);\n  }\n\n  class ReadOnlyMockHandler extends ReadOnlyHandler {\n    constructor(object, mock) {\n      // Note: object@other(unsafe) mock:this(unsafe) throws@this(unsafe)\n      super(object);\n      this.mock = mock;\n    }\n\n    get(target, key, receiver) {\n      // Note: target@this(unsafe) key@prim receiver@this(unsafe) throws@this(unsafe)\n      const object = this.object; // @other(unsafe)\n\n      const mock = this.mock;\n\n      if (thisReflectApply(thisObjectHasOwnProperty, mock, key) && !thisOtherHasOwnProperty(object, key)) {\n        return mock[key];\n      }\n\n      return super.get(target, key, receiver);\n    }\n\n  }\n\n  function thisFromOther(other) {\n    // Note: other@other(unsafe) returns@this(unsafe) throws@this(unsafe)\n    return thisFromOtherWithFactory(defaultFactory, other);\n  }\n\n  function thisProxyOther(factory, other, proto) {\n    const target = thisCreateTargetObject(other, proto);\n    const handler = factory(other);\n    const proxy = new ThisProxy(target, handler);\n\n    try {\n      otherReflectApply(otherWeakMapSet, mappingThisToOther, [proxy, other]);\n      registerProxy(proxy, handler);\n    } catch (e) {\n      throw new VMError('Unexpected error');\n    }\n\n    if (!isHost) {\n      thisReflectApply(thisWeakMapSet, mappingOtherToThis, [other, proxy]);\n      return proxy;\n    }\n\n    const proxy2 = new ThisProxy(proxy, emptyForzenObject);\n\n    try {\n      otherReflectApply(otherWeakMapSet, mappingThisToOther, [proxy2, other]);\n      registerProxy(proxy2, handler);\n    } catch (e) {\n      throw new VMError('Unexpected error');\n    }\n\n    thisReflectApply(thisWeakMapSet, mappingOtherToThis, [other, proxy2]);\n    return proxy2;\n  }\n\n  function thisEnsureThis(other) {\n    const type = typeof other;\n\n    switch (type) {\n      case 'object':\n        if (other === null) {\n          return null;\n        }\n\n      // fallthrough\n\n      case 'function':\n        let proto = thisReflectGetPrototypeOf(other);\n\n        if (!proto) {\n          return other;\n        }\n\n        while (proto) {\n          const mapping = thisReflectApply(thisMapGet, protoMappings, [proto]);\n\n          if (mapping) {\n            const mapped = thisReflectApply(thisWeakMapGet, mappingOtherToThis, [other]);\n            if (mapped) return mapped;\n            return mapping(defaultFactory, other);\n          }\n\n          proto = thisReflectGetPrototypeOf(proto);\n        }\n\n        return other;\n\n      case 'undefined':\n      case 'string':\n      case 'number':\n      case 'boolean':\n      case 'symbol':\n      case 'bigint':\n        return other;\n\n      default:\n        // new, unknown types can be dangerous\n        throw new VMError(`Unknown type '${type}'`);\n    }\n  }\n\n  function thisFromOtherForThrow(other) {\n    for (let loop = 0; loop < 10; loop++) {\n      const type = typeof other;\n\n      switch (type) {\n        case 'object':\n          if (other === null) {\n            return null;\n          }\n\n        // fallthrough\n\n        case 'function':\n          const mapped = thisReflectApply(thisWeakMapGet, mappingOtherToThis, [other]);\n          if (mapped) return mapped;\n          let proto;\n\n          try {\n            proto = otherReflectGetPrototypeOf(other);\n          } catch (e) {\n            // @other(unsafe)\n            other = e;\n            break;\n          }\n\n          if (!proto) {\n            return thisProxyOther(defaultFactory, other, null);\n          }\n\n          for (;;) {\n            const mapping = thisReflectApply(thisMapGet, protoMappings, [proto]);\n            if (mapping) return mapping(defaultFactory, other);\n\n            try {\n              proto = otherReflectGetPrototypeOf(proto);\n            } catch (e) {\n              // @other(unsafe)\n              other = e;\n              break;\n            }\n\n            if (!proto) return thisProxyOther(defaultFactory, other, thisObjectPrototype);\n          }\n\n          break;\n\n        case 'undefined':\n        case 'string':\n        case 'number':\n        case 'boolean':\n        case 'symbol':\n        case 'bigint':\n          return other;\n\n        default:\n          // new, unknown types can be dangerous\n          throw new VMError(`Unknown type '${type}'`);\n      }\n    }\n\n    throw new VMError('Exception recursion depth');\n  }\n\n  function thisFromOtherWithFactory(factory, other, proto) {\n    const type = typeof other;\n\n    switch (type) {\n      case 'object':\n        if (other === null) {\n          return null;\n        }\n\n      // fallthrough\n\n      case 'function':\n        const mapped = thisReflectApply(thisWeakMapGet, mappingOtherToThis, [other]);\n        if (mapped) return mapped;\n\n        if (proto) {\n          return thisProxyOther(factory, other, proto);\n        }\n\n        try {\n          proto = otherReflectGetPrototypeOf(other);\n        } catch (e) {\n          // @other(unsafe)\n          throw thisFromOtherForThrow(e);\n        }\n\n        if (!proto) {\n          return thisProxyOther(factory, other, null);\n        }\n\n        do {\n          const mapping = thisReflectApply(thisMapGet, protoMappings, [proto]);\n          if (mapping) return mapping(factory, other);\n\n          try {\n            proto = otherReflectGetPrototypeOf(proto);\n          } catch (e) {\n            // @other(unsafe)\n            throw thisFromOtherForThrow(e);\n          }\n        } while (proto);\n\n        return thisProxyOther(factory, other, thisObjectPrototype);\n\n      case 'undefined':\n      case 'string':\n      case 'number':\n      case 'boolean':\n      case 'symbol':\n      case 'bigint':\n        return other;\n\n      default:\n        // new, unknown types can be dangerous\n        throw new VMError(`Unknown type '${type}'`);\n    }\n  }\n\n  function thisFromOtherArguments(args) {\n    // Note: args@other(safe-array) returns@this(safe-array) throws@this(unsafe)\n    const arr = [];\n\n    for (let i = 0; i < args.length; i++) {\n      const value = thisFromOther(args[i]);\n      thisReflectDefineProperty(arr, i, {\n        __proto__: null,\n        value: value,\n        writable: true,\n        enumerable: true,\n        configurable: true\n      });\n    }\n\n    return arr;\n  }\n\n  function thisConnect(obj, other) {\n    // Note: obj@this(unsafe) other@other(unsafe) throws@this(unsafe)\n    try {\n      otherReflectApply(otherWeakMapSet, mappingThisToOther, [obj, other]);\n    } catch (e) {\n      throw new VMError('Unexpected error');\n    }\n\n    thisReflectApply(thisWeakMapSet, mappingOtherToThis, [other, obj]);\n  }\n\n  thisAddProtoMapping(thisGlobalPrototypes.Object, otherGlobalPrototypes.Object);\n  thisAddProtoMapping(thisGlobalPrototypes.Array, otherGlobalPrototypes.Array);\n\n  for (let i = 0; i < globalsList.length; i++) {\n    const key = globalsList[i];\n    const tp = thisGlobalPrototypes[key];\n    const op = otherGlobalPrototypes[key];\n    if (tp && op) thisAddProtoMapping(tp, op, key);\n  }\n\n  for (let i = 0; i < errorsList.length; i++) {\n    const key = errorsList[i];\n    const tp = thisGlobalPrototypes[key];\n    const op = otherGlobalPrototypes[key];\n    if (tp && op) thisAddProtoMapping(tp, op, 'Error');\n  }\n\n  thisAddProtoMapping(thisGlobalPrototypes.VMError, otherGlobalPrototypes.VMError, 'Error');\n  result.BaseHandler = BaseHandler;\n  result.ProtectedHandler = ProtectedHandler;\n  result.ReadOnlyHandler = ReadOnlyHandler;\n  result.ReadOnlyMockHandler = ReadOnlyMockHandler;\n  return result;\n}\n\nexports.createBridge = createBridge;\nexports.VMError = VMError;","map":{"version":3,"sources":["C:/Users/Bin Tran/Desktop/BUAG/BUAG/frontend/node_modules/vm2/lib/bridge.js"],"names":["globalsList","errorsList","OPNA","thisGlobalPrototypes","__proto__","Object","prototype","Array","i","length","key","g","global","getPrototypeOf","thisReflectGetPrototypeOf","setPrototypeOf","thisReflectSetPrototypeOf","defineProperty","thisReflectDefineProperty","deleteProperty","thisReflectDeleteProperty","getOwnPropertyDescriptor","thisReflectGetOwnPropertyDescriptor","isExtensible","thisReflectIsExtensible","preventExtensions","thisReflectPreventExtensions","apply","thisReflectApply","construct","thisReflectConstruct","set","thisReflectSet","get","thisReflectGet","has","thisReflectHas","ownKeys","thisReflectOwnKeys","enumerate","thisReflectEnumerate","Reflect","thisObject","freeze","thisObjectFreeze","thisObjectPrototype","thisObjectHasOwnProperty","hasOwnProperty","ThisProxy","Proxy","ThisWeakMap","WeakMap","thisWeakMapGet","thisWeakMapSet","ThisMap","Map","thisMapGet","thisMapSet","thisFunction","Function","thisFunctionBind","bind","thisArrayIsArray","isArray","thisErrorCaptureStackTrace","Error","captureStackTrace","thisSymbolToString","Symbol","toString","thisSymbolToStringTag","toStringTag","VMError","constructor","message","code","name","thisUnexpected","exports","thisSafeGetOwnPropertyDescriptor","obj","desc","thisThrowCallerCalleeArgumentsAccess","thisIdMapping","factory","other","thisThrowOnKeyAccessHandler","target","receiver","emptyForzenObject","thisThrowOnKeyAccess","SafeBase","value","SHARED_FUNCTION","TEST_PROXY_HANDLER","thisIsConstructor","Func","e","thisCreateTargetObject","proto","base","createBridge","otherInit","registerProxy","mappingOtherToThis","protoMappings","protoName","thisAddProtoMapping","object","thisProxyOther","thisAddProtoMappingFactory","protoFactory","result","globalPrototypes","safeGetOwnPropertyDescriptor","fromArguments","thisFromOtherArguments","from","thisFromOther","fromWithFactory","thisFromOtherWithFactory","ensureThis","thisEnsureThis","mapping","connect","thisConnect","reflectSet","reflectGet","reflectDefineProperty","reflectDeleteProperty","reflectApply","reflectConstruct","reflectHas","reflectOwnKeys","reflectEnumerate","reflectGetPrototypeOf","reflectIsExtensible","reflectPreventExtensions","objectHasOwnProperty","weakMapSet","addProtoMapping","addProtoMappingFactory","defaultFactory","protectedFactory","readonlyFactory","isHost","otherGlobalPrototypes","otherSafeGetOwnPropertyDescriptor","otherFromThisArguments","otherFromThis","mappingThisToOther","otherReflectSet","otherReflectGet","otherReflectDefineProperty","otherReflectDeleteProperty","otherReflectApply","otherReflectConstruct","otherReflectHas","otherReflectOwnKeys","otherReflectEnumerate","otherReflectGetPrototypeOf","otherReflectIsExtensible","otherReflectPreventExtensions","otherObjectHasOwnProperty","otherWeakMapSet","thisOtherHasOwnProperty","thisFromOtherForThrow","thisDefaultGet","handler","ret","getter","undefined","fromOtherWithContext","otherFromThisIfAvailable","to","BaseHandler","getFactory","doPreventExtensions","keys","configurable","current","enumerable","writable","context","args","newTarget","getOwnPropertyDescriptorDesc","prop","thisDesc","oldDesc","definePropertyDesc","otherDesc","hasFunc","hasValue","hasBasic","res","ProtectedHandler","ReadOnlyHandler","ReadOnlyMockHandler","mock","proxy","proxy2","type","mapped","loop","arr","tp","op"],"mappings":"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","sourcesContent":["'use strict';\n\n/**\n * __        ___    ____  _   _ ___ _   _  ____\n * \\ \\      / / \\  |  _ \\| \\ | |_ _| \\ | |/ ___|\n *  \\ \\ /\\ / / _ \\ | |_) |  \\| || ||  \\| | |  _\n *   \\ V  V / ___ \\|  _ <| |\\  || || |\\  | |_| |\n *    \\_/\\_/_/   \\_\\_| \\_\\_| \\_|___|_| \\_|\\____|\n *\n * This file is critical for vm2. It implements the bridge between the host and the sandbox.\n * If you do not know exactly what you are doing, you should NOT edit this file.\n *\n * The file is loaded in the host and sandbox to handle objects in both directions.\n * This is done to ensure that RangeErrors are from the correct context.\n * The boundary between the sandbox and host might throw RangeErrors from both contexts.\n * Therefore, thisFromOther and friends can handle objects from both domains.\n *\n * Method parameters have comments to tell from which context they came.\n *\n */\n\nconst globalsList = [\n\t'Number',\n\t'String',\n\t'Boolean',\n\t'Date',\n\t'RegExp',\n\t'Map',\n\t'WeakMap',\n\t'Set',\n\t'WeakSet',\n\t'Promise',\n\t'Function'\n];\n\nconst errorsList = [\n\t'RangeError',\n\t'ReferenceError',\n\t'SyntaxError',\n\t'TypeError',\n\t'EvalError',\n\t'URIError',\n\t'Error'\n];\n\nconst OPNA = 'Operation not allowed on contextified object.';\n\nconst thisGlobalPrototypes = {\n\t__proto__: null,\n\tObject: Object.prototype,\n\tArray: Array.prototype\n};\n\nfor (let i = 0; i < globalsList.length; i++) {\n\tconst key = globalsList[i];\n\tconst g = global[key];\n\tif (g) thisGlobalPrototypes[key] = g.prototype;\n}\n\nfor (let i = 0; i < errorsList.length; i++) {\n\tconst key = errorsList[i];\n\tconst g = global[key];\n\tif (g) thisGlobalPrototypes[key] = g.prototype;\n}\n\nconst {\n\tgetPrototypeOf: thisReflectGetPrototypeOf,\n\tsetPrototypeOf: thisReflectSetPrototypeOf,\n\tdefineProperty: thisReflectDefineProperty,\n\tdeleteProperty: thisReflectDeleteProperty,\n\tgetOwnPropertyDescriptor: thisReflectGetOwnPropertyDescriptor,\n\tisExtensible: thisReflectIsExtensible,\n\tpreventExtensions: thisReflectPreventExtensions,\n\tapply: thisReflectApply,\n\tconstruct: thisReflectConstruct,\n\tset: thisReflectSet,\n\tget: thisReflectGet,\n\thas: thisReflectHas,\n\townKeys: thisReflectOwnKeys,\n\tenumerate: thisReflectEnumerate,\n} = Reflect;\n\nconst thisObject = Object;\nconst {\n\tfreeze: thisObjectFreeze,\n\tprototype: thisObjectPrototype\n} = thisObject;\nconst thisObjectHasOwnProperty = thisObjectPrototype.hasOwnProperty;\nconst ThisProxy = Proxy;\nconst ThisWeakMap = WeakMap;\nconst {\n\tget: thisWeakMapGet,\n\tset: thisWeakMapSet\n} = ThisWeakMap.prototype;\nconst ThisMap = Map;\nconst thisMapGet = ThisMap.prototype.get;\nconst thisMapSet = ThisMap.prototype.set;\nconst thisFunction = Function;\nconst thisFunctionBind = thisFunction.prototype.bind;\nconst thisArrayIsArray = Array.isArray;\nconst thisErrorCaptureStackTrace = Error.captureStackTrace;\n\nconst thisSymbolToString = Symbol.prototype.toString;\nconst thisSymbolToStringTag = Symbol.toStringTag;\n\n/**\n * VMError.\n *\n * @public\n * @extends {Error}\n */\nclass VMError extends Error {\n\n\t/**\n\t * Create VMError instance.\n\t *\n\t * @public\n\t * @param {string} message - Error message.\n\t * @param {string} code - Error code.\n\t */\n\tconstructor(message, code) {\n\t\tsuper(message);\n\n\t\tthis.name = 'VMError';\n\t\tthis.code = code;\n\n\t\tthisErrorCaptureStackTrace(this, this.constructor);\n\t}\n}\n\nthisGlobalPrototypes['VMError'] = VMError.prototype;\n\nfunction thisUnexpected() {\n\treturn new VMError('Unexpected');\n}\n\nif (!thisReflectSetPrototypeOf(exports, null)) throw thisUnexpected();\n\nfunction thisSafeGetOwnPropertyDescriptor(obj, key) {\n\tconst desc = thisReflectGetOwnPropertyDescriptor(obj, key);\n\tif (!desc) return desc;\n\tif (!thisReflectSetPrototypeOf(desc, null)) throw thisUnexpected();\n\treturn desc;\n}\n\nfunction thisThrowCallerCalleeArgumentsAccess(key) {\n\t'use strict';\n\tthisThrowCallerCalleeArgumentsAccess[key];\n\treturn thisUnexpected();\n}\n\nfunction thisIdMapping(factory, other) {\n\treturn other;\n}\n\nconst thisThrowOnKeyAccessHandler = thisObjectFreeze({\n\t__proto__: null,\n\tget(target, key, receiver) {\n\t\tif (typeof key === 'symbol') {\n\t\t\tkey = thisReflectApply(thisSymbolToString, key, []);\n\t\t}\n\t\tthrow new VMError(`Unexpected access to key '${key}'`);\n\t}\n});\n\nconst emptyForzenObject = thisObjectFreeze({\n\t__proto__: null\n});\n\nconst thisThrowOnKeyAccess = new ThisProxy(emptyForzenObject, thisThrowOnKeyAccessHandler);\n\nfunction SafeBase() {}\n\nif (!thisReflectDefineProperty(SafeBase, 'prototype', {\n\t__proto__: null,\n\tvalue: thisThrowOnKeyAccess\n})) throw thisUnexpected();\n\nfunction SHARED_FUNCTION() {}\n\nconst TEST_PROXY_HANDLER = thisObjectFreeze({\n\t__proto__: thisThrowOnKeyAccess,\n\tconstruct() {\n\t\treturn this;\n\t}\n});\n\nfunction thisIsConstructor(obj) {\n\t// Note: obj@any(unsafe)\n\tconst Func = new ThisProxy(obj, TEST_PROXY_HANDLER);\n\ttry {\n\t\t// eslint-disable-next-line no-new\n\t\tnew Func();\n\t\treturn true;\n\t} catch (e) {\n\t\treturn false;\n\t}\n}\n\nfunction thisCreateTargetObject(obj, proto) {\n\t// Note: obj@any(unsafe) proto@any(unsafe) returns@this(unsafe) throws@this(unsafe)\n\tlet base;\n\tif (typeof obj === 'function') {\n\t\tif (thisIsConstructor(obj)) {\n\t\t\t// Bind the function since bound functions do not have a prototype property.\n\t\t\tbase = thisReflectApply(thisFunctionBind, SHARED_FUNCTION, [null]);\n\t\t} else {\n\t\t\tbase = () => {};\n\t\t}\n\t} else if (thisArrayIsArray(obj)) {\n\t\tbase = [];\n\t} else {\n\t\treturn {__proto__: proto};\n\t}\n\tif (!thisReflectSetPrototypeOf(base, proto)) throw thisUnexpected();\n\treturn base;\n}\n\nfunction createBridge(otherInit, registerProxy) {\n\n\tconst mappingOtherToThis = new ThisWeakMap();\n\tconst protoMappings = new ThisMap();\n\tconst protoName = new ThisMap();\n\n\tfunction thisAddProtoMapping(proto, other, name) {\n\t\t// Note: proto@this(unsafe) other@other(unsafe) name@this(unsafe) throws@this(unsafe)\n\t\tthisReflectApply(thisMapSet, protoMappings, [proto, thisIdMapping]);\n\t\tthisReflectApply(thisMapSet, protoMappings, [other,\n\t\t\t(factory, object) => thisProxyOther(factory, object, proto)]);\n\t\tif (name) thisReflectApply(thisMapSet, protoName, [proto, name]);\n\t}\n\n\tfunction thisAddProtoMappingFactory(protoFactory, other, name) {\n\t\t// Note: protoFactory@this(unsafe) other@other(unsafe) name@this(unsafe) throws@this(unsafe)\n\t\tlet proto;\n\t\tthisReflectApply(thisMapSet, protoMappings, [other,\n\t\t\t(factory, object) => {\n\t\t\t\tif (!proto) {\n\t\t\t\t\tproto = protoFactory();\n\t\t\t\t\tthisReflectApply(thisMapSet, protoMappings, [proto, thisIdMapping]);\n\t\t\t\t\tif (name) thisReflectApply(thisMapSet, protoName, [proto, name]);\n\t\t\t\t}\n\t\t\t\treturn thisProxyOther(factory, object, proto);\n\t\t\t}]);\n\t}\n\n\tconst result = {\n\t\t__proto__: null,\n\t\tglobalPrototypes: thisGlobalPrototypes,\n\t\tsafeGetOwnPropertyDescriptor: thisSafeGetOwnPropertyDescriptor,\n\t\tfromArguments: thisFromOtherArguments,\n\t\tfrom: thisFromOther,\n\t\tfromWithFactory: thisFromOtherWithFactory,\n\t\tensureThis: thisEnsureThis,\n\t\tmapping: mappingOtherToThis,\n\t\tconnect: thisConnect,\n\t\treflectSet: thisReflectSet,\n\t\treflectGet: thisReflectGet,\n\t\treflectDefineProperty: thisReflectDefineProperty,\n\t\treflectDeleteProperty: thisReflectDeleteProperty,\n\t\treflectApply: thisReflectApply,\n\t\treflectConstruct: thisReflectConstruct,\n\t\treflectHas: thisReflectHas,\n\t\treflectOwnKeys: thisReflectOwnKeys,\n\t\treflectEnumerate: thisReflectEnumerate,\n\t\treflectGetPrototypeOf: thisReflectGetPrototypeOf,\n\t\treflectIsExtensible: thisReflectIsExtensible,\n\t\treflectPreventExtensions: thisReflectPreventExtensions,\n\t\tobjectHasOwnProperty: thisObjectHasOwnProperty,\n\t\tweakMapSet: thisWeakMapSet,\n\t\taddProtoMapping: thisAddProtoMapping,\n\t\taddProtoMappingFactory: thisAddProtoMappingFactory,\n\t\tdefaultFactory,\n\t\tprotectedFactory,\n\t\treadonlyFactory,\n\t\tVMError\n\t};\n\n\tconst isHost = typeof otherInit !== 'object';\n\n\tif (isHost) {\n\t\totherInit = otherInit(result, registerProxy);\n\t}\n\n\tresult.other = otherInit;\n\n\tconst {\n\t\tglobalPrototypes: otherGlobalPrototypes,\n\t\tsafeGetOwnPropertyDescriptor: otherSafeGetOwnPropertyDescriptor,\n\t\tfromArguments: otherFromThisArguments,\n\t\tfrom: otherFromThis,\n\t\tmapping: mappingThisToOther,\n\t\treflectSet: otherReflectSet,\n\t\treflectGet: otherReflectGet,\n\t\treflectDefineProperty: otherReflectDefineProperty,\n\t\treflectDeleteProperty: otherReflectDeleteProperty,\n\t\treflectApply: otherReflectApply,\n\t\treflectConstruct: otherReflectConstruct,\n\t\treflectHas: otherReflectHas,\n\t\treflectOwnKeys: otherReflectOwnKeys,\n\t\treflectEnumerate: otherReflectEnumerate,\n\t\treflectGetPrototypeOf: otherReflectGetPrototypeOf,\n\t\treflectIsExtensible: otherReflectIsExtensible,\n\t\treflectPreventExtensions: otherReflectPreventExtensions,\n\t\tobjectHasOwnProperty: otherObjectHasOwnProperty,\n\t\tweakMapSet: otherWeakMapSet\n\t} = otherInit;\n\n\tfunction thisOtherHasOwnProperty(object, key) {\n\t\t// Note: object@other(safe) key@prim throws@this(unsafe)\n\t\ttry {\n\t\t\treturn otherReflectApply(otherObjectHasOwnProperty, object, [key]) === true;\n\t\t} catch (e) { // @other(unsafe)\n\t\t\tthrow thisFromOtherForThrow(e);\n\t\t}\n\t}\n\n\tfunction thisDefaultGet(handler, object, key, desc) {\n\t\t// Note: object@other(unsafe) key@prim desc@other(safe)\n\t\tlet ret; // @other(unsafe)\n\t\tif (desc.get || desc.set) {\n\t\t\tconst getter = desc.get;\n\t\t\tif (!getter) return undefined;\n\t\t\ttry {\n\t\t\t\tret = otherReflectApply(getter, object, [key]);\n\t\t\t} catch (e) {\n\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t}\n\t\t} else {\n\t\t\tret = desc.value;\n\t\t}\n\t\treturn handler.fromOtherWithContext(ret);\n\t}\n\n\tfunction otherFromThisIfAvailable(to, from, key) {\n\t\t// Note: to@other(safe) from@this(safe) key@prim throws@this(unsafe)\n\t\tif (!thisReflectApply(thisObjectHasOwnProperty, from, [key])) return false;\n\t\ttry {\n\t\t\tto[key] = otherFromThis(from[key]);\n\t\t} catch (e) { // @other(unsafe)\n\t\t\tthrow thisFromOtherForThrow(e);\n\t\t}\n\t\treturn true;\n\t}\n\n\tclass BaseHandler extends SafeBase {\n\n\t\tconstructor(object) {\n\t\t\t// Note: object@other(unsafe) throws@this(unsafe)\n\t\t\tsuper();\n\t\t\tthis.object = object;\n\t\t}\n\n\t\tgetFactory() {\n\t\t\treturn defaultFactory;\n\t\t}\n\n\t\tfromOtherWithContext(other) {\n\t\t\t// Note: other@other(unsafe) throws@this(unsafe)\n\t\t\treturn thisFromOtherWithFactory(this.getFactory(), other);\n\t\t}\n\n\t\tdoPreventExtensions(target, object, factory) {\n\t\t\t// Note: target@this(unsafe) object@other(unsafe) throws@this(unsafe)\n\t\t\tlet keys; // @other(safe-array-of-prim)\n\t\t\ttry {\n\t\t\t\tkeys = otherReflectOwnKeys(object);\n\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t}\n\t\t\tfor (let i = 0; i < keys.length; i++) {\n\t\t\t\tconst key = keys[i]; // @prim\n\t\t\t\tlet desc;\n\t\t\t\ttry {\n\t\t\t\t\tdesc = otherSafeGetOwnPropertyDescriptor(object, key);\n\t\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t\t}\n\t\t\t\tif (!desc) continue;\n\t\t\t\tif (!desc.configurable) {\n\t\t\t\t\tconst current = thisSafeGetOwnPropertyDescriptor(target, key);\n\t\t\t\t\tif (current && !current.configurable) continue;\n\t\t\t\t\tif (desc.get || desc.set) {\n\t\t\t\t\t\tdesc.get = this.fromOtherWithContext(desc.get);\n\t\t\t\t\t\tdesc.set = this.fromOtherWithContext(desc.set);\n\t\t\t\t\t} else if (typeof object === 'function' && (key === 'caller' || key === 'callee' || key === 'arguments')) {\n\t\t\t\t\t\tdesc.value = null;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdesc.value = this.fromOtherWithContext(desc.value);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (desc.get || desc.set) {\n\t\t\t\t\t\tdesc = {\n\t\t\t\t\t\t\t__proto__: null,\n\t\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\t\tenumerable: desc.enumerable,\n\t\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\t\tvalue: null\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdesc.value = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!thisReflectDefineProperty(target, key, desc)) throw thisUnexpected();\n\t\t\t}\n\t\t\tif (!thisReflectPreventExtensions(target)) throw thisUnexpected();\n\t\t}\n\n\t\tget(target, key, receiver) {\n\t\t\t// Note: target@this(unsafe) key@prim receiver@this(unsafe) throws@this(unsafe)\n\t\t\tconst object = this.object; // @other(unsafe)\n\t\t\tswitch (key) {\n\t\t\t\tcase 'constructor': {\n\t\t\t\t\tconst desc = otherSafeGetOwnPropertyDescriptor(object, key);\n\t\t\t\t\tif (desc) return thisDefaultGet(this, object, key, desc);\n\t\t\t\t\tconst proto = thisReflectGetPrototypeOf(target);\n\t\t\t\t\treturn proto === null ? undefined : proto.constructor;\n\t\t\t\t}\n\t\t\t\tcase '__proto__': {\n\t\t\t\t\tconst desc = otherSafeGetOwnPropertyDescriptor(object, key);\n\t\t\t\t\tif (desc) return thisDefaultGet(this, object, key, desc);\n\t\t\t\t\treturn thisReflectGetPrototypeOf(target);\n\t\t\t\t}\n\t\t\t\tcase thisSymbolToStringTag:\n\t\t\t\t\tif (!thisOtherHasOwnProperty(object, thisSymbolToStringTag)) {\n\t\t\t\t\t\tconst proto = thisReflectGetPrototypeOf(target);\n\t\t\t\t\t\tconst name = thisReflectApply(thisMapGet, protoName, [proto]);\n\t\t\t\t\t\tif (name) return name;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'arguments':\n\t\t\t\tcase 'caller':\n\t\t\t\tcase 'callee':\n\t\t\t\t\tif (typeof object === 'function' && thisOtherHasOwnProperty(object, key)) {\n\t\t\t\t\t\tthrow thisThrowCallerCalleeArgumentsAccess(key);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tlet ret; // @other(unsafe)\n\t\t\ttry {\n\t\t\t\tret = otherReflectGet(object, key);\n\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t}\n\t\t\treturn this.fromOtherWithContext(ret);\n\t\t}\n\n\t\tset(target, key, value, receiver) {\n\t\t\t// Note: target@this(unsafe) key@prim value@this(unsafe) receiver@this(unsafe) throws@this(unsafe)\n\t\t\tconst object = this.object; // @other(unsafe)\n\t\t\tif (key === '__proto__' && !thisOtherHasOwnProperty(object, key)) {\n\t\t\t\treturn this.setPrototypeOf(target, value);\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tvalue = otherFromThis(value);\n\t\t\t\treturn otherReflectSet(object, key, value) === true;\n\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t}\n\t\t}\n\n\t\tgetPrototypeOf(target) {\n\t\t\t// Note: target@this(unsafe)\n\t\t\treturn thisReflectGetPrototypeOf(target);\n\t\t}\n\n\t\tsetPrototypeOf(target, value) {\n\t\t\t// Note: target@this(unsafe) throws@this(unsafe)\n\t\t\tthrow new VMError(OPNA);\n\t\t}\n\n\t\tapply(target, context, args) {\n\t\t\t// Note: target@this(unsafe) context@this(unsafe) args@this(safe-array) throws@this(unsafe)\n\t\t\tconst object = this.object; // @other(unsafe)\n\t\t\tlet ret; // @other(unsafe)\n\t\t\ttry {\n\t\t\t\tcontext = otherFromThis(context);\n\t\t\t\targs = otherFromThisArguments(args);\n\t\t\t\tret = otherReflectApply(object, context, args);\n\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t}\n\t\t\treturn thisFromOther(ret);\n\t\t}\n\n\t\tconstruct(target, args, newTarget) {\n\t\t\t// Note: target@this(unsafe) args@this(safe-array) newTarget@this(unsafe) throws@this(unsafe)\n\t\t\tconst object = this.object; // @other(unsafe)\n\t\t\tlet ret; // @other(unsafe)\n\t\t\ttry {\n\t\t\t\targs = otherFromThisArguments(args);\n\t\t\t\tret = otherReflectConstruct(object, args);\n\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t}\n\t\t\treturn thisFromOtherWithFactory(this.getFactory(), ret, thisFromOther(object));\n\t\t}\n\n\t\tgetOwnPropertyDescriptorDesc(target, prop, desc) {\n\t\t\t// Note: target@this(unsafe) prop@prim desc@other{safe} throws@this(unsafe)\n\t\t\tconst object = this.object; // @other(unsafe)\n\t\t\tif (desc && typeof object === 'function' && (prop === 'arguments' || prop === 'caller' || prop === 'callee')) desc.value = null;\n\t\t\treturn desc;\n\t\t}\n\n\t\tgetOwnPropertyDescriptor(target, prop) {\n\t\t\t// Note: target@this(unsafe) prop@prim throws@this(unsafe)\n\t\t\tconst object = this.object; // @other(unsafe)\n\t\t\tlet desc; // @other(safe)\n\t\t\ttry {\n\t\t\t\tdesc = otherSafeGetOwnPropertyDescriptor(object, prop);\n\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t}\n\n\t\t\tdesc = this.getOwnPropertyDescriptorDesc(target, prop, desc);\n\n\t\t\tif (!desc) return undefined;\n\n\t\t\tlet thisDesc;\n\t\t\tif (desc.get || desc.set) {\n\t\t\t\tthisDesc = {\n\t\t\t\t\t__proto__: null,\n\t\t\t\t\tget: this.fromOtherWithContext(desc.get),\n\t\t\t\t\tset: this.fromOtherWithContext(desc.set),\n\t\t\t\t\tenumerable: desc.enumerable === true,\n\t\t\t\t\tconfigurable: desc.configurable === true\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tthisDesc = {\n\t\t\t\t\t__proto__: null,\n\t\t\t\t\tvalue: this.fromOtherWithContext(desc.value),\n\t\t\t\t\twritable: desc.writable === true,\n\t\t\t\t\tenumerable: desc.enumerable === true,\n\t\t\t\t\tconfigurable: desc.configurable === true\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (!thisDesc.configurable) {\n\t\t\t\tconst oldDesc = thisSafeGetOwnPropertyDescriptor(target, prop);\n\t\t\t\tif (!oldDesc || oldDesc.configurable || oldDesc.writable !== thisDesc.writable) {\n\t\t\t\t\tif (!thisReflectDefineProperty(target, prop, thisDesc)) throw thisUnexpected();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn thisDesc;\n\t\t}\n\n\t\tdefinePropertyDesc(target, prop, desc) {\n\t\t\t// Note: target@this(unsafe) prop@prim desc@this(safe) throws@this(unsafe)\n\t\t\treturn desc;\n\t\t}\n\n\t\tdefineProperty(target, prop, desc) {\n\t\t\t// Note: target@this(unsafe) prop@prim desc@this(unsafe) throws@this(unsafe)\n\t\t\tconst object = this.object; // @other(unsafe)\n\t\t\tif (!thisReflectSetPrototypeOf(desc, null)) throw thisUnexpected();\n\n\t\t\tdesc = this.definePropertyDesc(target, prop, desc);\n\n\t\t\tif (!desc) return false;\n\n\t\t\tlet otherDesc = {__proto__: null};\n\t\t\tlet hasFunc = true;\n\t\t\tlet hasValue = true;\n\t\t\tlet hasBasic = true;\n\t\t\thasFunc &= otherFromThisIfAvailable(otherDesc, desc, 'get');\n\t\t\thasFunc &= otherFromThisIfAvailable(otherDesc, desc, 'set');\n\t\t\thasValue &= otherFromThisIfAvailable(otherDesc, desc, 'value');\n\t\t\thasValue &= otherFromThisIfAvailable(otherDesc, desc, 'writable');\n\t\t\thasBasic &= otherFromThisIfAvailable(otherDesc, desc, 'enumerable');\n\t\t\thasBasic &= otherFromThisIfAvailable(otherDesc, desc, 'configurable');\n\n\t\t\ttry {\n\t\t\t\tif (!otherReflectDefineProperty(object, prop, otherDesc)) return false;\n\t\t\t\tif (otherDesc.configurable !== true && (!hasBasic || !(hasFunc || hasValue))) {\n\t\t\t\t\totherDesc = otherSafeGetOwnPropertyDescriptor(object, prop);\n\t\t\t\t}\n\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t}\n\n\t\t\tif (!otherDesc.configurable) {\n\t\t\t\tlet thisDesc;\n\t\t\t\tif (otherDesc.get || otherDesc.set) {\n\t\t\t\t\tthisDesc = {\n\t\t\t\t\t\t__proto__: null,\n\t\t\t\t\t\tget: this.fromOtherWithContext(otherDesc.get),\n\t\t\t\t\t\tset: this.fromOtherWithContext(otherDesc.set),\n\t\t\t\t\t\tenumerable: otherDesc.enumerable,\n\t\t\t\t\t\tconfigurable: otherDesc.configurable\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tthisDesc = {\n\t\t\t\t\t\t__proto__: null,\n\t\t\t\t\t\tvalue: this.fromOtherWithContext(otherDesc.value),\n\t\t\t\t\t\twritable: otherDesc.writable,\n\t\t\t\t\t\tenumerable: otherDesc.enumerable,\n\t\t\t\t\t\tconfigurable: otherDesc.configurable\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif (!thisReflectDefineProperty(target, prop, thisDesc)) throw thisUnexpected();\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tdeleteProperty(target, prop) {\n\t\t\t// Note: target@this(unsafe) prop@prim throws@this(unsafe)\n\t\t\tconst object = this.object; // @other(unsafe)\n\t\t\ttry {\n\t\t\t\treturn otherReflectDeleteProperty(object, prop) === true;\n\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t}\n\t\t}\n\n\t\thas(target, key) {\n\t\t\t// Note: target@this(unsafe) key@prim throws@this(unsafe)\n\t\t\tconst object = this.object; // @other(unsafe)\n\t\t\ttry {\n\t\t\t\treturn otherReflectHas(object, key) === true;\n\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t}\n\t\t}\n\n\t\tisExtensible(target) {\n\t\t\t// Note: target@this(unsafe) throws@this(unsafe)\n\t\t\tconst object = this.object; // @other(unsafe)\n\t\t\ttry {\n\t\t\t\tif (otherReflectIsExtensible(object)) return true;\n\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t}\n\t\t\tif (thisReflectIsExtensible(target)) {\n\t\t\t\tthis.doPreventExtensions(target, object, this);\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\townKeys(target) {\n\t\t\t// Note: target@this(unsafe) throws@this(unsafe)\n\t\t\tconst object = this.object; // @other(unsafe)\n\t\t\tlet res; // @other(unsafe)\n\t\t\ttry {\n\t\t\t\tres = otherReflectOwnKeys(object);\n\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t}\n\t\t\treturn thisFromOther(res);\n\t\t}\n\n\t\tpreventExtensions(target) {\n\t\t\t// Note: target@this(unsafe) throws@this(unsafe)\n\t\t\tconst object = this.object; // @other(unsafe)\n\t\t\ttry {\n\t\t\t\tif (!otherReflectPreventExtensions(object)) return false;\n\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t}\n\t\t\tif (thisReflectIsExtensible(target)) {\n\t\t\t\tthis.doPreventExtensions(target, object, this);\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tenumerate(target) {\n\t\t\t// Note: target@this(unsafe) throws@this(unsafe)\n\t\t\tconst object = this.object; // @other(unsafe)\n\t\t\tlet res; // @other(unsafe)\n\t\t\ttry {\n\t\t\t\tres = otherReflectEnumerate(object);\n\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t}\n\t\t\treturn this.fromOtherWithContext(res);\n\t\t}\n\n\t}\n\n\tfunction defaultFactory(object) {\n\t\t// Note: other@other(unsafe) returns@this(unsafe) throws@this(unsafe)\n\t\treturn new BaseHandler(object);\n\t}\n\n\tclass ProtectedHandler extends BaseHandler {\n\n\t\tgetFactory() {\n\t\t\treturn protectedFactory;\n\t\t}\n\n\t\tset(target, key, value, receiver) {\n\t\t\t// Note: target@this(unsafe) key@prim value@this(unsafe) receiver@this(unsafe) throws@this(unsafe)\n\t\t\tif (typeof value === 'function') {\n\t\t\t\treturn thisReflectDefineProperty(receiver, key, {\n\t\t\t\t\t__proto__: null,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\twritable: true,\n\t\t\t\t\tenumerable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t}) === true;\n\t\t\t}\n\t\t\treturn super.set(target, key, value, receiver);\n\t\t}\n\n\t\tdefinePropertyDesc(target, prop, desc) {\n\t\t\t// Note: target@this(unsafe) prop@prim desc@this(safe) throws@this(unsafe)\n\t\t\tif (desc && (desc.set || desc.get || typeof desc.value === 'function')) return undefined;\n\t\t\treturn desc;\n\t\t}\n\n\t}\n\n\tfunction protectedFactory(object) {\n\t\t// Note: other@other(unsafe) returns@this(unsafe) throws@this(unsafe)\n\t\treturn new ProtectedHandler(object);\n\t}\n\n\tclass ReadOnlyHandler extends BaseHandler {\n\n\t\tgetFactory() {\n\t\t\treturn readonlyFactory;\n\t\t}\n\n\t\tset(target, key, value, receiver) {\n\t\t\t// Note: target@this(unsafe) key@prim value@this(unsafe) receiver@this(unsafe) throws@this(unsafe)\n\t\t\treturn thisReflectDefineProperty(receiver, key, {\n\t\t\t\t__proto__: null,\n\t\t\t\tvalue: value,\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: true,\n\t\t\t\tconfigurable: true\n\t\t\t});\n\t\t}\n\n\t\tsetPrototypeOf(target, value) {\n\t\t\t// Note: target@this(unsafe) throws@this(unsafe)\n\t\t\treturn false;\n\t\t}\n\n\t\tdefineProperty(target, prop, desc) {\n\t\t\t// Note: target@this(unsafe) prop@prim desc@this(unsafe) throws@this(unsafe)\n\t\t\treturn false;\n\t\t}\n\n\t\tdeleteProperty(target, prop) {\n\t\t\t// Note: target@this(unsafe) prop@prim throws@this(unsafe)\n\t\t\treturn false;\n\t\t}\n\n\t\tisExtensible(target) {\n\t\t\t// Note: target@this(unsafe) throws@this(unsafe)\n\t\t\treturn false;\n\t\t}\n\n\t\tpreventExtensions(target) {\n\t\t\t// Note: target@this(unsafe) throws@this(unsafe)\n\t\t\treturn false;\n\t\t}\n\n\t}\n\n\tfunction readonlyFactory(object) {\n\t\t// Note: other@other(unsafe) returns@this(unsafe) throws@this(unsafe)\n\t\treturn new ReadOnlyHandler(object);\n\t}\n\n\tclass ReadOnlyMockHandler extends ReadOnlyHandler {\n\n\t\tconstructor(object, mock) {\n\t\t\t// Note: object@other(unsafe) mock:this(unsafe) throws@this(unsafe)\n\t\t\tsuper(object);\n\t\t\tthis.mock = mock;\n\t\t}\n\n\t\tget(target, key, receiver) {\n\t\t\t// Note: target@this(unsafe) key@prim receiver@this(unsafe) throws@this(unsafe)\n\t\t\tconst object = this.object; // @other(unsafe)\n\t\t\tconst mock = this.mock;\n\t\t\tif (thisReflectApply(thisObjectHasOwnProperty, mock, key) && !thisOtherHasOwnProperty(object, key)) {\n\t\t\t\treturn mock[key];\n\t\t\t}\n\t\t\treturn super.get(target, key, receiver);\n\t\t}\n\n\t}\n\n\tfunction thisFromOther(other) {\n\t\t// Note: other@other(unsafe) returns@this(unsafe) throws@this(unsafe)\n\t\treturn thisFromOtherWithFactory(defaultFactory, other);\n\t}\n\n\tfunction thisProxyOther(factory, other, proto) {\n\t\tconst target = thisCreateTargetObject(other, proto);\n\t\tconst handler = factory(other);\n\t\tconst proxy = new ThisProxy(target, handler);\n\t\ttry {\n\t\t\totherReflectApply(otherWeakMapSet, mappingThisToOther, [proxy, other]);\n\t\t\tregisterProxy(proxy, handler);\n\t\t} catch (e) {\n\t\t\tthrow new VMError('Unexpected error');\n\t\t}\n\t\tif (!isHost) {\n\t\t\tthisReflectApply(thisWeakMapSet, mappingOtherToThis, [other, proxy]);\n\t\t\treturn proxy;\n\t\t}\n\t\tconst proxy2 = new ThisProxy(proxy, emptyForzenObject);\n\t\ttry {\n\t\t\totherReflectApply(otherWeakMapSet, mappingThisToOther, [proxy2, other]);\n\t\t\tregisterProxy(proxy2, handler);\n\t\t} catch (e) {\n\t\t\tthrow new VMError('Unexpected error');\n\t\t}\n\t\tthisReflectApply(thisWeakMapSet, mappingOtherToThis, [other, proxy2]);\n\t\treturn proxy2;\n\t}\n\n\tfunction thisEnsureThis(other) {\n\t\tconst type = typeof other;\n\t\tswitch (type) {\n\t\t\tcase 'object':\n\t\t\t\tif (other === null) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\t// fallthrough\n\t\t\tcase 'function':\n\t\t\t\tlet proto = thisReflectGetPrototypeOf(other);\n\t\t\t\tif (!proto) {\n\t\t\t\t\treturn other;\n\t\t\t\t}\n\t\t\t\twhile (proto) {\n\t\t\t\t\tconst mapping = thisReflectApply(thisMapGet, protoMappings, [proto]);\n\t\t\t\t\tif (mapping) {\n\t\t\t\t\t\tconst mapped = thisReflectApply(thisWeakMapGet, mappingOtherToThis, [other]);\n\t\t\t\t\t\tif (mapped) return mapped;\n\t\t\t\t\t\treturn mapping(defaultFactory, other);\n\t\t\t\t\t}\n\t\t\t\t\tproto = thisReflectGetPrototypeOf(proto);\n\t\t\t\t}\n\t\t\t\treturn other;\n\t\t\tcase 'undefined':\n\t\t\tcase 'string':\n\t\t\tcase 'number':\n\t\t\tcase 'boolean':\n\t\t\tcase 'symbol':\n\t\t\tcase 'bigint':\n\t\t\t\treturn other;\n\n\t\t\tdefault: // new, unknown types can be dangerous\n\t\t\t\tthrow new VMError(`Unknown type '${type}'`);\n\t\t}\n\t}\n\n\tfunction thisFromOtherForThrow(other) {\n\t\tfor (let loop = 0; loop < 10; loop++) {\n\t\t\tconst type = typeof other;\n\t\t\tswitch (type) {\n\t\t\t\tcase 'object':\n\t\t\t\t\tif (other === null) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t\t// fallthrough\n\t\t\t\tcase 'function':\n\t\t\t\t\tconst mapped = thisReflectApply(thisWeakMapGet, mappingOtherToThis, [other]);\n\t\t\t\t\tif (mapped) return mapped;\n\t\t\t\t\tlet proto;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tproto = otherReflectGetPrototypeOf(other);\n\t\t\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\t\t\tother = e;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tif (!proto) {\n\t\t\t\t\t\treturn thisProxyOther(defaultFactory, other, null);\n\t\t\t\t\t}\n\t\t\t\t\tfor (;;) {\n\t\t\t\t\t\tconst mapping = thisReflectApply(thisMapGet, protoMappings, [proto]);\n\t\t\t\t\t\tif (mapping) return mapping(defaultFactory, other);\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tproto = otherReflectGetPrototypeOf(proto);\n\t\t\t\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\t\t\t\tother = e;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!proto) return thisProxyOther(defaultFactory, other, thisObjectPrototype);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'undefined':\n\t\t\t\tcase 'string':\n\t\t\t\tcase 'number':\n\t\t\t\tcase 'boolean':\n\t\t\t\tcase 'symbol':\n\t\t\t\tcase 'bigint':\n\t\t\t\t\treturn other;\n\n\t\t\t\tdefault: // new, unknown types can be dangerous\n\t\t\t\t\tthrow new VMError(`Unknown type '${type}'`);\n\t\t\t}\n\t\t}\n\t\tthrow new VMError('Exception recursion depth');\n\t}\n\n\tfunction thisFromOtherWithFactory(factory, other, proto) {\n\t\tconst type = typeof other;\n\t\tswitch (type) {\n\t\t\tcase 'object':\n\t\t\t\tif (other === null) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\t// fallthrough\n\t\t\tcase 'function':\n\t\t\t\tconst mapped = thisReflectApply(thisWeakMapGet, mappingOtherToThis, [other]);\n\t\t\t\tif (mapped) return mapped;\n\t\t\t\tif (proto) {\n\t\t\t\t\treturn thisProxyOther(factory, other, proto);\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\tproto = otherReflectGetPrototypeOf(other);\n\t\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t\t}\n\t\t\t\tif (!proto) {\n\t\t\t\t\treturn thisProxyOther(factory, other, null);\n\t\t\t\t}\n\t\t\t\tdo {\n\t\t\t\t\tconst mapping = thisReflectApply(thisMapGet, protoMappings, [proto]);\n\t\t\t\t\tif (mapping) return mapping(factory, other);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tproto = otherReflectGetPrototypeOf(proto);\n\t\t\t\t\t} catch (e) { // @other(unsafe)\n\t\t\t\t\t\tthrow thisFromOtherForThrow(e);\n\t\t\t\t\t}\n\t\t\t\t} while (proto);\n\t\t\t\treturn thisProxyOther(factory, other, thisObjectPrototype);\n\t\t\tcase 'undefined':\n\t\t\tcase 'string':\n\t\t\tcase 'number':\n\t\t\tcase 'boolean':\n\t\t\tcase 'symbol':\n\t\t\tcase 'bigint':\n\t\t\t\treturn other;\n\n\t\t\tdefault: // new, unknown types can be dangerous\n\t\t\t\tthrow new VMError(`Unknown type '${type}'`);\n\t\t}\n\t}\n\n\tfunction thisFromOtherArguments(args) {\n\t\t// Note: args@other(safe-array) returns@this(safe-array) throws@this(unsafe)\n\t\tconst arr = [];\n\t\tfor (let i = 0; i < args.length; i++) {\n\t\t\tconst value = thisFromOther(args[i]);\n\t\t\tthisReflectDefineProperty(arr, i, {\n\t\t\t\t__proto__: null,\n\t\t\t\tvalue: value,\n\t\t\t\twritable: true,\n\t\t\t\tenumerable: true,\n\t\t\t\tconfigurable: true\n\t\t\t});\n\t\t}\n\t\treturn arr;\n\t}\n\n\tfunction thisConnect(obj, other) {\n\t\t// Note: obj@this(unsafe) other@other(unsafe) throws@this(unsafe)\n\t\ttry {\n\t\t\totherReflectApply(otherWeakMapSet, mappingThisToOther, [obj, other]);\n\t\t} catch (e) {\n\t\t\tthrow new VMError('Unexpected error');\n\t\t}\n\t\tthisReflectApply(thisWeakMapSet, mappingOtherToThis, [other, obj]);\n\t}\n\n\tthisAddProtoMapping(thisGlobalPrototypes.Object, otherGlobalPrototypes.Object);\n\tthisAddProtoMapping(thisGlobalPrototypes.Array, otherGlobalPrototypes.Array);\n\n\tfor (let i = 0; i < globalsList.length; i++) {\n\t\tconst key = globalsList[i];\n\t\tconst tp = thisGlobalPrototypes[key];\n\t\tconst op = otherGlobalPrototypes[key];\n\t\tif (tp && op) thisAddProtoMapping(tp, op, key);\n\t}\n\n\tfor (let i = 0; i < errorsList.length; i++) {\n\t\tconst key = errorsList[i];\n\t\tconst tp = thisGlobalPrototypes[key];\n\t\tconst op = otherGlobalPrototypes[key];\n\t\tif (tp && op) thisAddProtoMapping(tp, op, 'Error');\n\t}\n\n\tthisAddProtoMapping(thisGlobalPrototypes.VMError, otherGlobalPrototypes.VMError, 'Error');\n\n\tresult.BaseHandler = BaseHandler;\n\tresult.ProtectedHandler = ProtectedHandler;\n\tresult.ReadOnlyHandler = ReadOnlyHandler;\n\tresult.ReadOnlyMockHandler = ReadOnlyMockHandler;\n\n\treturn result;\n}\n\nexports.createBridge = createBridge;\nexports.VMError = VMError;\n"]},"metadata":{},"sourceType":"script"}