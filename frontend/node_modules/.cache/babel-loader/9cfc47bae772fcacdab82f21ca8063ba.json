{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Bin Tran\\\\Desktop\\\\BUAG\\\\BUAG\\\\frontend\\\\src\\\\features\\\\teststripe\\\\Checkoutform.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport { useStripe, useElements, CardElement } from '@stripe/react-stripe-js';\nimport Cardinput from \"./CardInput\";\nimport stripeApi from '../../api/stripeApi';\nimport { message } from 'antd';\nimport \"./card.css\";\nimport { useDispatch, useSelector } from 'react-redux';\nimport { addhoadon, hoadonData } from '../container/admin/Hoadon/hoadonSlice';\nimport { useHistory } from 'react-router-dom';\nimport Axios from 'axios';\nimport sendemailApi from '../../api/sendemailApi';\nimport getUserApi from '../../api/getUserApi';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function CheckoutForm(props) {\n  _s();\n\n  const [btn, setBtn] = useState(true);\n  const stripe = useStripe();\n  const elements = useElements();\n  const email = props.email;\n  const price = props.price * 100;\n  const hoadon = props.hoadon;\n  const tentour = props.tentour;\n  console.log(tentour);\n  const thanhtien = props.thanhtien;\n  const dispatch = useDispatch();\n  const history = useHistory();\n\n  const actionhoadon = async () => {\n    await dispatch(hoadonData());\n  };\n\n  const handleSubmit = async event => {\n    event.preventDefault();\n\n    if (!stripe || !elements) {\n      return;\n    }\n\n    console.log(\"ok\");\n    setBtn(false);\n    var res = await stripeApi.poststripe({\n      email,\n      price\n    }).then(ok => {\n      return ok.client_secret;\n    });\n    console.log(res);\n    var clientSecret = res;\n    const result = await stripe.confirmCardPayment(clientSecret, {\n      payment_method: {\n        card: elements.getElement(CardElement),\n        billing_details: {\n          email: email\n        }\n      }\n    });\n\n    if (result.error) {\n      message.warning(\"Số thẻ hoặc thông tin khác không hợp lệ!\");\n    } else {\n      if (result.paymentIntent.status === 'succeeded') {\n        console.log(\"thanh cong\");\n        message.success(\"Thanh toán thành công!\");\n        console.log(hoadon);\n        dispatch(addhoadon({\n          tourId: hoadon.tourId,\n          userId: hoadon.userId,\n          embe: hoadon.embe,\n          treem: hoadon.treem,\n          nguoilon: hoadon.nguoilon,\n          ngaydi: hoadon.ngaydi,\n          thanhtien: thanhtien\n        }));\n        actionhoadon();\n        const resUser = await getUserApi.getUser(hoadon.userId);\n        const objSendEmail = {\n          email: resUser.data.email,\n          name: resUser.data.name,\n          thanhtien: tongtien.toLocaleString(),\n          orderDate: new Date().toISOString().split('T')[0],\n          orderId: 12156561\n        };\n        await sendemailApi.sendemail(objSendEmail);\n        history.push(`/tour/${hoadon.tourId}`);\n      }\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    onSubmit: handleSubmit,\n    children: [/*#__PURE__*/_jsxDEV(Cardinput, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 13\n    }, this), btn ? /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn-payment\",\n      disabled: !stripe,\n      children: \"Thanh to\\xE1n\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 17\n    }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn-payment ac\",\n      disabled: \"false\",\n      children: \"Thanh to\\xE1n\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 72,\n    columnNumber: 9\n  }, this);\n}\n\n_s(CheckoutForm, \"M2De1eN/disvVooK8Wuyh1UdwMI=\", false, function () {\n  return [useStripe, useElements, useDispatch, useHistory];\n});\n\n_c = CheckoutForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"CheckoutForm\");","map":{"version":3,"sources":["C:/Users/Bin Tran/Desktop/BUAG/BUAG/frontend/src/features/teststripe/Checkoutform.js"],"names":["React","useState","useStripe","useElements","CardElement","Cardinput","stripeApi","message","useDispatch","useSelector","addhoadon","hoadonData","useHistory","Axios","sendemailApi","getUserApi","CheckoutForm","props","btn","setBtn","stripe","elements","email","price","hoadon","tentour","console","log","thanhtien","dispatch","history","actionhoadon","handleSubmit","event","preventDefault","res","poststripe","then","ok","client_secret","clientSecret","result","confirmCardPayment","payment_method","card","getElement","billing_details","error","warning","paymentIntent","status","success","tourId","userId","embe","treem","nguoilon","ngaydi","resUser","getUser","objSendEmail","data","name","tongtien","toLocaleString","orderDate","Date","toISOString","split","orderId","sendemail","push"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\r\nimport { useStripe, useElements, CardElement } from '@stripe/react-stripe-js';\r\nimport Cardinput from \"./CardInput\"\r\nimport stripeApi from '../../api/stripeApi';\r\nimport { message } from 'antd';\r\nimport \"./card.css\";\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { addhoadon, hoadonData } from '../container/admin/Hoadon/hoadonSlice';\r\nimport { useHistory } from 'react-router-dom';\r\nimport Axios from 'axios';\r\nimport sendemailApi from '../../api/sendemailApi'\r\nimport getUserApi from '../../api/getUserApi'\r\n\r\nexport default function CheckoutForm(props) {\r\n    const [btn, setBtn] = useState(true)\r\n    const stripe = useStripe();\r\n    const elements = useElements();\r\n    const email = props.email;\r\n    const price = props.price * 100;\r\n    const hoadon = props.hoadon;\r\n    const tentour = props.tentour;\r\n    console.log(tentour);\r\n    const thanhtien = props.thanhtien;\r\n    const dispatch = useDispatch();\r\n    const history = useHistory();\r\n    const actionhoadon = async () => { await dispatch(hoadonData()) }\r\n\r\n    const handleSubmit = async (event) => {\r\n        event.preventDefault()\r\n        if (!stripe || !elements) {\r\n            return;\r\n        }\r\n        console.log(\"ok\");\r\n        setBtn(false)\r\n        var res = await stripeApi.poststripe({ email, price }).then(ok => {\r\n            return ok.client_secret;\r\n        })\r\n        console.log(res);\r\n        var clientSecret = res;\r\n        const result = await stripe.confirmCardPayment(clientSecret, {\r\n            payment_method: {\r\n                card: elements.getElement(CardElement),\r\n                billing_details: {\r\n                    email: email,\r\n                },\r\n            }\r\n        });\r\n        if (result.error) {\r\n            message.warning(\"Số thẻ hoặc thông tin khác không hợp lệ!\");\r\n        } else {\r\n            if (result.paymentIntent.status === 'succeeded') {\r\n                console.log(\"thanh cong\");\r\n                message.success(\"Thanh toán thành công!\");\r\n                console.log(hoadon)\r\n                dispatch(addhoadon({ tourId: hoadon.tourId, userId: hoadon.userId, embe: hoadon.embe, treem: hoadon.treem, nguoilon: hoadon.nguoilon, ngaydi: hoadon.ngaydi, thanhtien: thanhtien }));\r\n                actionhoadon();\r\n                const resUser = await getUserApi.getUser(hoadon.userId)\r\n                const objSendEmail = {\r\n                  email: resUser.data.email,\r\n                  name: resUser.data.name,\r\n                  thanhtien: tongtien.toLocaleString(),\r\n                  orderDate: new Date().toISOString().split('T')[0],\r\n                  orderId: 12156561\r\n                }\r\n                await sendemailApi.sendemail(objSendEmail)\r\n                history.push(`/tour/${hoadon.tourId}`);\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <form onSubmit={handleSubmit}>\r\n            <Cardinput />\r\n            {btn ?\r\n                <button className=\"btn-payment\" disabled={!stripe}>Thanh toán</button>\r\n                :\r\n                <button className=\"btn-payment ac\" disabled=\"false\">Thanh toán</button>\r\n            }\r\n        </form>\r\n    );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}