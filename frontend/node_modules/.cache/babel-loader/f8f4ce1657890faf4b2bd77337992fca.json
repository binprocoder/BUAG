{"ast":null,"code":"/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2015 Mailjet\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nconst DEBUG_MODE = false;\nconst RESOURCE = 0;\nconst ID = 1;\nconst ACTION = 2;\n/*\n * Imports.\n *\n * qs is used to format the url from the provided parameters and method\n * _path will join a path according to the OS specifications\n * https will be used to make a secure http request to the API\n * fs will simply be used to read files\n */\n\nconst qs = require('querystring');\n\nconst request = require('superagent');\n\nconst _path = require('path');\n\nconst JSONb = require('json-bigint')({\n  storeAsString: true\n});\n\nconst version = require('./package.json').version;\n/* Extend superagent request with proxy method */\n\n\nrequire('superagent-proxy')(request);\n\nfunction setValueIfExist(targetObject, path, value) {\n  if (value) {\n    targetObject[path] = value;\n  }\n}\n/*\n * MailjetClient constructor.\n *\n * @qpi_key (optional) {String} mailjet account api key\n * @api_secret (optional) {String} mailjet account api secret\n * @options (optional) {Object} additional connection options\n *\n * If you don't know what this is about, sign up to Mailjet at:\n * https://www.mailjet.com/\n */\n\n\nfunction MailjetClient(api_key, api_secret, options, perform_api_call) {\n  return this.authStrategy(api_key, api_secret, options, perform_api_call);\n}\n/**\n * @param (optional){String} api_key || api_token\n * @param (optional){String} api_secret\n * @param (optional){Object} options\n * @param (optional){any} perform_api_call\n */\n\n\nMailjetClient.prototype.authStrategy = function (api_key, api_secret, options, perform_api_call) {\n  var isTokenRequired = this.isTokenRequired(api_key, api_secret, options, perform_api_call);\n  var self = this; // Check if api version requires toekn authentication\n  // This is one of the approaches, maybe there is better\n\n  if (isTokenRequired) {\n    // params are shifted one position to left as we don't have api secret any more\n    // api_key becomes api_token\n    // api_secret becomes options\n    // options becomes perform_api_call\n    return tokenAuthentication(api_key, api_secret, options);\n  } else {\n    // params are in correct order\n    return basicAuthentication(api_key, api_secret, options, perform_api_call);\n  }\n  /**\n   *\n   * @param (optional){String} api_key mailjet api key\n   * @param (optional){String} api_secret mailjet api secret\n   * @param (optional){Object} options additional connection options\n   * @param (optional){boolean} perform_api_call\n   */\n\n\n  function basicAuthentication(api_key, api_secret, options, perform_api_call) {\n    self.config = self.setConfig(options);\n    self.perform_api_call = perform_api_call || false; // To be updated according to the npm repo version\n\n    self.version = version;\n\n    if (api_key && api_secret) {\n      self.connect(api_key, api_secret, options);\n    }\n\n    return self;\n  }\n  /**\n   *\n   * @param (optional){String} api_token mailjet api token\n   * @param (optional){Object} options additional connection options\n   * @param (optional){boolean} perform_api_call\n   */\n\n\n  function tokenAuthentication(api_token, options, perform_api_call) {\n    self.perform_api_call = perform_api_call || false; // To be updated according to the npm repo version\n\n    self.version = version;\n\n    if (api_token) {\n      self.connect(api_token, options);\n    }\n\n    return self;\n  }\n};\n\nMailjetClient.prototype.isTokenRequired = function () {\n  var args = [].slice.call(arguments);\n  var vals = args.filter(a => a !== undefined);\n\n  if (DEBUG_MODE) {\n    console.log('Defined arguments: ' + JSON.stringify(vals));\n  }\n\n  return vals.length === 1 || vals.length >= 2 && typeof vals[1] === 'object';\n};\n\nMailjetClient.prototype.typeJson = function (body) {\n  var keys = Object.keys(body);\n\n  for (var i in keys) {\n    var key = keys[i];\n    body[key] = parseInt(body[key]) || body[key];\n  }\n\n  return body;\n};\n/*\n * [Static] connect.\n *\n * Return a nez connected instance of the MailjetClient class\n *\n * @k {String} mailjet qpi key\n * @s {String} mailjet api secret\n * @o {String} optional connection options\n *\n */\n\n\nMailjetClient.connect = function (k, s, o) {\n  return new MailjetClient().connect(k, s, o);\n};\n/*\n * connect.\n *\n * create a auth property from the api key and secret\n *\n * @apiKey || @apiToken {String}\n * @apiSecret {String}\n * @options {Object}\n *\n */\n\n\nMailjetClient.prototype.connect = function (apiKey, apiSecret, options) {\n  return this.connectStrategy(apiKey, apiSecret, options);\n};\n/**\n * @param (optional){String} apiKey || apiToken\n * @param (optional){String} apiSecret\n * @param (optional){Object} options\n */\n\n\nMailjetClient.prototype.connectStrategy = function (apiKey, apiSecret, options) {\n  var self = this;\n  var isTokenRequired = this.isTokenRequired(apiKey, apiSecret, options);\n\n  if (isTokenRequired) {\n    return tokenConnectStrategy(apiKey, apiSecret);\n  } else {\n    return basicConnectStrategy(apiKey, apiSecret, options);\n  }\n\n  function basicConnectStrategy(apiKey, apiSecret, options) {\n    if (!apiKey) {\n      throw new Error('Mailjet API_KEY is required');\n    }\n\n    if (!apiSecret) {\n      throw new Error('Mailjet API_SECRET is required');\n    }\n\n    setOptions(options);\n    self.apiKey = apiKey;\n    self.apiSecret = apiSecret;\n    return self;\n  }\n\n  function tokenConnectStrategy(apiToken, options) {\n    setOptions(options);\n\n    if (!apiToken) {\n      throw new Error('Mailjet API_TOKEN is required');\n    }\n\n    self.apiToken = apiToken;\n    return self;\n  }\n\n  function setOptions(options) {\n    self.options = options || {};\n\n    if (self.options) {\n      self.config = self.setConfig(options);\n    }\n  }\n};\n\nMailjetClient.prototype.setConfig = function (options) {\n  const config = require('./config.json');\n\n  if (typeof options === 'object' && options != null && options.length != 0) {\n    if (options.url) config.url = options.url;\n    if (options.version) config.version = options.version;\n    if (options.perform_api_call) config.perform_api_call = options.perform_api_call;\n  } else if (options != null) {\n    throw new Error('warning, your options variable is not a valid object.');\n  }\n\n  return config;\n};\n/*\n * path.\n *\n * Returns a formatted url from a http method and\n * a parameters object literal\n *\n * @resource {String}\n * @sub {String} REST/''/DATA\n * @params {Object literal} {name: value}\n *\n */\n\n\nMailjetClient.prototype.path = function (resource, sub, params, options) {\n  if (DEBUG_MODE) {\n    console.log('resource =', resource);\n    console.log('subPath =', sub);\n    console.log('filters =', params);\n  }\n\n  const url = options && 'url' in options ? options.url : this.config.url;\n  const api_version = options && 'version' in options ? options.version : this.config.version;\n\n  const base = _path.join(api_version, sub);\n\n  if (Object.keys(params).length === 0) {\n    return _path.join(url, base + '/' + resource);\n  }\n\n  const querystring = qs.stringify(params);\n  return _path.join(url, base + '/' + resource + '?' + querystring);\n};\n/*\n * httpRequest.\n *\n * @method {String} http method (GET/POST...)\n * @url {String} url path to be used for the request\n * @data {Object literal} additional data espacially for POST/PUT operations\n * @callback -optional {Function} called on response from the server, or on error\n *\n * @return a promise triggering 'success' on response\n * \t\tand error on error\n */\n\n\nMailjetClient.prototype.httpRequest = function (method, url, data, callback, perform_api_call) {\n  var req = request[method](url).set('user-agent', 'mailjet-api-v3-nodejs/' + this.version).set('Content-type', url.indexOf('text:plain') > -1 ? 'text/plain' : 'application/json');\n\n  if (this.apiToken) {\n    req.set('Authorization', 'Bearer ' + this.apiToken);\n  } else {\n    req.auth(this.apiKey, this.apiSecret);\n  }\n\n  if (this.options.proxyUrl) {\n    req = req.proxy(this.options.proxyUrl);\n  }\n\n  if (this.options.timeout) {\n    req = req.timeout(this.options.timeout);\n  }\n\n  const payload = method === 'post' || method === 'put' ? data : {};\n\n  if (DEBUG_MODE) {\n    console.log('Final url: ' + url);\n    console.log('body: ' + JSON.stringify(payload));\n  }\n\n  if (perform_api_call === false || this.perform_api_call) {\n    return Promise.resolve({\n      body: payload,\n      url: url\n    });\n  }\n\n  if (method === 'delete') {\n    method = 'del';\n  }\n\n  if (method === 'post' || method === 'put') {\n    req = req.send(data);\n  }\n\n  return new Promise(function (resolve, reject) {\n    const ret = function (err, result) {\n      return typeof callback === 'function' ? callback(err, result) : err ? reject(err) : resolve(result);\n    };\n\n    req.end(function (err, result) {\n      var body;\n\n      try {\n        body = JSONb.parse(result.text);\n      } catch (e) {\n        body = {};\n      }\n\n      if (err) {\n        const error = new Error();\n        error.ErrorMessage = body.ErrorMessage || err.message;\n        error.statusCode = err.status || null;\n        error.response = result || null;\n        error.message = `Unsuccessful: Status Code: \"${error.statusCode}\" Message: \"${error.ErrorMessage}\"`;\n        setValueIfExist(error, 'ErrorIdentifier', body.ErrorIdentifier);\n        setValueIfExist(error, 'ErrorCode', body.ErrorCode);\n        setValueIfExist(error, 'ErrorRelatedTo', body.ErrorRelatedTo);\n        return ret(error);\n      }\n\n      return ret(null, {\n        response: result,\n        body: body\n      });\n    });\n  });\n};\n/*\n *\n * MailjetResource constructor\n *\n * This class creates a function that can be build through method chaining\n *\n * @method {String} http method\n * @func {String} resource/path to be sent\n * @context {MailjetClient[instance]} parent client\n */\n\n\nfunction MailjetResource(method, func, options, context) {\n  this.base = func;\n  this.callUrl = func;\n  this.options = options || context.options;\n  this.resource = func.toLowerCase();\n  this.lastAdded = RESOURCE;\n  var self = context;\n  /*\n  It can be REST or nothing if we only know the resource\n  */\n\n  this.subPath = function () {\n    if (func.toLowerCase() !== 'send' && func.indexOf('sms') === -1) {\n      return 'REST';\n    }\n\n    return '';\n  }();\n  /**\n   *\n   * result.\n   *\n   * @params (optional) {Object Littteral} parameters to be sent to the server\n   * @callback (optional) {Function} called on response or error\n   */\n\n\n  var that = this;\n\n  this.result = function (params, callback) {\n    params = params || {};\n\n    if (typeof params === 'function') {\n      callback = params;\n      params = {};\n    }\n    /*\n    We build the querystring depending on the parameters. if the user explicitly mentionned\n    a filters property, we pass it to the url\n    */\n\n\n    var path = self.path(that.callUrl, that.subPath, function () {\n      if (params.filters) {\n        var ret = params.filters;\n        delete params.filters;\n        return ret;\n      } else if (method === 'get') {\n        return params;\n      } else {\n        return {};\n      }\n    }(), that.options);\n    var perform_api_call = null;\n\n    if (that.options && 'perform_api_call' in that.options) {\n      perform_api_call = that.options.perform_api_call;\n    } else {\n      perform_api_call = self.config.perform_api_call;\n    }\n\n    that.callUrl = that.base;\n    self.lastAdded = RESOURCE;\n    return self.httpRequest(method, 'https://' + path, params, callback, perform_api_call);\n  };\n}\n/**\n *\n * id.\n *\n * Add an ID and prevent invalid id chaining\n *\n * @value {String/Number} append an id to the path\n * @return the MailjetResource instance to allow method chaining\n *\n */\n\n\nMailjetResource.prototype.id = function (value) {\n  if (this.lastAdded === ID && DEBUG_MODE) {\n    console.warn('[WARNING] your request may fail due to invalid id chaining');\n  }\n\n  this.callUrl = _path.join(this.callUrl, value.toString());\n  this.lastAdded = ID;\n  return this;\n};\n/**\n *\n * action.\n *\n * Add an Action and prevent invalid action chaining\n *\n * @value {String} append an action to the path\n * @return the MailjetResource instance to allow method chaining\n *\n */\n\n\nMailjetResource.prototype.action = function (name) {\n  if (this.lastAdded === ACTION && DEBUG_MODE) {\n    console.warn('[WARNING] your request may fail due to invalid action chaining');\n  }\n\n  this.callUrl = _path.join(this.callUrl, name);\n  this.action = name.toLowerCase();\n  this.lastAdded = ACTION;\n\n  if (this.action.toLowerCase() === 'csvdata') {\n    this.action = 'csvdata/text:plain';\n  } else if (this.action.toLowerCase() === 'csverror') {\n    this.action = 'csverror/text:csv';\n  }\n\n  var self = this;\n\n  this.subPath = function () {\n    if (self.resource === 'contactslist' && self.action === 'csvdata/text:plain' || self.resource === 'batchjob' && self.action === 'csverror/text:csv') {\n      return 'DATA';\n    } else {\n      return self.subPath;\n    }\n  }();\n\n  return self;\n};\n/**\n *\n * request.\n *\n * @parmas {Object literal} method parameters\n * @callback (optional) {Function} triggered when done\n *\n * @return {String} the server response\n */\n\n\nMailjetResource.prototype.request = function (params, callback) {\n  return this.result(params, callback).catch(function (err) {\n    try {\n      const ErrorDetails = JSON.parse(err.response.text);\n      const fullMessage = ErrorDetails.Messages[0].Errors[0].ErrorMessage;\n\n      if (typeof fullMessage === \"string\") {\n        err.message = err.message + \";\\n\" + fullMessage;\n        throw err;\n      }\n\n      throw err;\n    } catch {\n      throw err;\n    }\n  });\n};\n/*\n * post.\n *\n * @func {String} required Mailjet API function to be used (can contain a whole action path)\n *\n * @returns a function that make an httpRequest for each call\n */\n\n\nMailjetClient.prototype.post = function (func, options) {\n  return new MailjetResource('post', func, options, this);\n};\n/*\n * get.\n *\n * @func {String} required Mailjet API function to be used (can contain a whole action path)\n *\n * @returns a function that make an httpRequest for each call\n */\n\n\nMailjetClient.prototype.get = function (func, options) {\n  return new MailjetResource('get', func, options, this);\n};\n/*\n * delete.\n *\n * @func {String} required Mailjet API function to be used (can contain a whole action path)\n *\n * @returns a function that make an httpRequest for each call\n */\n\n\nMailjetClient.prototype.delete = function (func, options) {\n  return new MailjetResource('delete', func, options, this);\n};\n/*\n * put.\n *\n * @func {String} required Mailjet API function to be used (can contain a whole action path)\n *\n * @returns a function that make an httpRequest for each call\n */\n\n\nMailjetClient.prototype.put = function (func, options) {\n  return new MailjetResource('put', func, options, this);\n};\n/*\n * Exports the Mailjet client.\n *\n * you can require it like so:\n * var mj = require ('./mailjet-client')\n *\n * or for the bleeding edge developpers out there:\n * import mj from './mailjet-client'\n */\n\n\nmodule.exports = MailjetClient;","map":{"version":3,"sources":["C:/Users/Bin Tran/Desktop/BUAG/BUAG/frontend/node_modules/node-mailjet/mailjet-client.js"],"names":["DEBUG_MODE","RESOURCE","ID","ACTION","qs","require","request","_path","JSONb","storeAsString","version","setValueIfExist","targetObject","path","value","MailjetClient","api_key","api_secret","options","perform_api_call","authStrategy","prototype","isTokenRequired","self","tokenAuthentication","basicAuthentication","config","setConfig","connect","api_token","args","slice","call","arguments","vals","filter","a","undefined","console","log","JSON","stringify","length","typeJson","body","keys","Object","i","key","parseInt","k","s","o","apiKey","apiSecret","connectStrategy","tokenConnectStrategy","basicConnectStrategy","Error","setOptions","apiToken","url","resource","sub","params","api_version","base","join","querystring","httpRequest","method","data","callback","req","set","indexOf","auth","proxyUrl","proxy","timeout","payload","Promise","resolve","send","reject","ret","err","result","end","parse","text","e","error","ErrorMessage","message","statusCode","status","response","ErrorIdentifier","ErrorCode","ErrorRelatedTo","MailjetResource","func","context","callUrl","toLowerCase","lastAdded","subPath","that","filters","id","warn","toString","action","name","catch","ErrorDetails","fullMessage","Messages","Errors","post","get","delete","put","module","exports"],"mappings":"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","sourcesContent":["/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2015 Mailjet\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\n\nconst DEBUG_MODE = false\nconst RESOURCE = 0\nconst ID = 1\nconst ACTION = 2\n\n/*\n * Imports.\n *\n * qs is used to format the url from the provided parameters and method\n * _path will join a path according to the OS specifications\n * https will be used to make a secure http request to the API\n * fs will simply be used to read files\n */\n\nconst qs = require('querystring')\nconst request = require('superagent')\nconst _path = require('path')\nconst JSONb = require('json-bigint')({ storeAsString: true })\nconst version = require('./package.json').version\n\n/* Extend superagent request with proxy method */\nrequire('superagent-proxy')(request)\n\nfunction setValueIfExist(targetObject, path, value) {\n  if(value) {\n    targetObject[path] = value;\n  }\n}\n\n/*\n * MailjetClient constructor.\n *\n * @qpi_key (optional) {String} mailjet account api key\n * @api_secret (optional) {String} mailjet account api secret\n * @options (optional) {Object} additional connection options\n *\n * If you don't know what this is about, sign up to Mailjet at:\n * https://www.mailjet.com/\n */\nfunction MailjetClient (api_key, api_secret, options, perform_api_call) {\n  return this.authStrategy(api_key, api_secret, options, perform_api_call)\n}\n\n/**\n * @param (optional){String} api_key || api_token\n * @param (optional){String} api_secret\n * @param (optional){Object} options\n * @param (optional){any} perform_api_call\n */\nMailjetClient.prototype.authStrategy = function(api_key, api_secret, options, perform_api_call) {\n\n  var isTokenRequired = this.isTokenRequired(api_key, api_secret, options, perform_api_call)\n  var self = this\n  // Check if api version requires toekn authentication\n  // This is one of the approaches, maybe there is better\n  if (isTokenRequired) {\n    // params are shifted one position to left as we don't have api secret any more\n    // api_key becomes api_token\n    // api_secret becomes options\n    // options becomes perform_api_call\n    return tokenAuthentication(api_key, api_secret, options)\n  } else {\n    // params are in correct order\n    return basicAuthentication(api_key, api_secret, options, perform_api_call)\n  }\n\n  /**\n   *\n   * @param (optional){String} api_key mailjet api key\n   * @param (optional){String} api_secret mailjet api secret\n   * @param (optional){Object} options additional connection options\n   * @param (optional){boolean} perform_api_call\n   */\n  function basicAuthentication(api_key, api_secret, options, perform_api_call) {\n\n    self.config = self.setConfig(options)\n    self.perform_api_call = perform_api_call || false\n    // To be updated according to the npm repo version\n    self.version = version\n    if (api_key && api_secret) {\n      self.connect(api_key, api_secret, options)\n    }\n\n    return self\n  }\n\n  /**\n   *\n   * @param (optional){String} api_token mailjet api token\n   * @param (optional){Object} options additional connection options\n   * @param (optional){boolean} perform_api_call\n   */\n  function tokenAuthentication(api_token, options, perform_api_call) {\n    self.perform_api_call = perform_api_call || false\n    // To be updated according to the npm repo version\n    self.version = version\n    if (api_token) {\n      self.connect(api_token, options)\n    }\n\n    return self\n  }\n}\n\nMailjetClient.prototype.isTokenRequired = function () {\n  var args = [].slice.call(arguments)\n  var vals = args.filter(a => a !== undefined)\n\n  if (DEBUG_MODE) {\n    console.log('Defined arguments: ' + JSON.stringify(vals))\n  }\n\n  return (vals.length === 1 || (vals.length >= 2 && typeof vals[1] === 'object'))\n}\n\nMailjetClient.prototype.typeJson = function (body) {\n  var keys = Object.keys(body)\n  for (var i in keys) {\n    var key = keys[i]\n    body[key] = parseInt(body[key]) || body[key]\n  }\n  return body\n}\n\n/*\n * [Static] connect.\n *\n * Return a nez connected instance of the MailjetClient class\n *\n * @k {String} mailjet qpi key\n * @s {String} mailjet api secret\n * @o {String} optional connection options\n *\n */\nMailjetClient.connect = function (k, s, o) {\n  return new MailjetClient().connect(k, s, o)\n}\n\n/*\n * connect.\n *\n * create a auth property from the api key and secret\n *\n * @apiKey || @apiToken {String}\n * @apiSecret {String}\n * @options {Object}\n *\n */\nMailjetClient.prototype.connect = function (apiKey, apiSecret, options) {\n  return this.connectStrategy(apiKey, apiSecret, options)\n}\n\n/**\n * @param (optional){String} apiKey || apiToken\n * @param (optional){String} apiSecret\n * @param (optional){Object} options\n */\nMailjetClient.prototype.connectStrategy = function (apiKey, apiSecret, options) {\n\n  var self = this\n  var isTokenRequired = this.isTokenRequired(apiKey, apiSecret, options)\n\n  if (isTokenRequired) {\n    return tokenConnectStrategy(apiKey, apiSecret)\n  } else {\n    return basicConnectStrategy(apiKey, apiSecret, options)\n  }\n\n  function basicConnectStrategy(apiKey, apiSecret, options) {\n    if (!apiKey) {\n      throw new Error('Mailjet API_KEY is required');\n    }\n    if (!apiSecret) {\n      throw new Error('Mailjet API_SECRET is required');\n    }\n\n    setOptions(options)\n    self.apiKey = apiKey\n    self.apiSecret = apiSecret\n    return self\n  }\n\n  function tokenConnectStrategy(apiToken, options) {\n    setOptions(options)\n    if (!apiToken) {\n      throw new Error('Mailjet API_TOKEN is required');\n    }\n\n    self.apiToken = apiToken\n    return self\n  }\n\n  function setOptions(options) {\n    self.options = options || {}\n    if (self.options) {\n      self.config = self.setConfig(options)\n    }\n  }\n}\n\nMailjetClient.prototype.setConfig = function (options) {\n  const config = require('./config.json')\n  if (typeof options === 'object' && options != null && options.length != 0) {\n    if (options.url) config.url = options.url\n    if (options.version) config.version = options.version\n    if (options.perform_api_call) config.perform_api_call = options.perform_api_call\n  } else if (options != null) {\n    throw new Error('warning, your options variable is not a valid object.')\n  }\n\n  return config\n}\n\n/*\n * path.\n *\n * Returns a formatted url from a http method and\n * a parameters object literal\n *\n * @resource {String}\n * @sub {String} REST/''/DATA\n * @params {Object literal} {name: value}\n *\n */\nMailjetClient.prototype.path = function (resource, sub, params, options) {\n  if (DEBUG_MODE) {\n    console.log('resource =', resource)\n    console.log('subPath =', sub)\n    console.log('filters =', params)\n  }\n\n  const url = (options && 'url' in options) ? options.url : this.config.url\n  const api_version = (options && 'version' in options) ? options.version : this.config.version\n\n  const base = _path.join(api_version, sub)\n  if (Object.keys(params).length === 0) {\n    return _path.join(url, base + '/' + resource)\n  }\n\n  const querystring = qs.stringify(params);\n  return _path.join(url, base + '/' + resource + '?' + querystring)\n}\n\n/*\n * httpRequest.\n *\n * @method {String} http method (GET/POST...)\n * @url {String} url path to be used for the request\n * @data {Object literal} additional data espacially for POST/PUT operations\n * @callback -optional {Function} called on response from the server, or on error\n *\n * @return a promise triggering 'success' on response\n * \t\tand error on error\n */\n\nMailjetClient.prototype.httpRequest = function (method, url, data, callback, perform_api_call){\n  var req = request[method](url)\n    .set('user-agent', 'mailjet-api-v3-nodejs/' + this.version)\n\n    .set('Content-type', url.indexOf('text:plain') > -1\n      ? 'text/plain'\n      : 'application/json')\n\n  if (this.apiToken) {\n    req.set('Authorization', 'Bearer ' + this.apiToken)\n  } else {\n    req.auth(this.apiKey, this.apiSecret)\n  }\n\n  if (this.options.proxyUrl) {\n    req = req.proxy(this.options.proxyUrl)\n  }\n  if (this.options.timeout) {\n    req = req.timeout(this.options.timeout)\n  }\n\n  const payload = method === 'post' || method === 'put' ? data : {}\n\n  if (DEBUG_MODE) {\n    console.log('Final url: ' + url)\n    console.log('body: ' + JSON.stringify(payload))\n  }\n\n  if (perform_api_call === false || this.perform_api_call) {\n    return Promise.resolve({body: payload, url: url})\n  }\n\n  if (method === 'delete') { method = 'del' }\n  if (method === 'post' || method === 'put') { req = req.send(data) }\n\n  return new Promise(function (resolve, reject) {\n\n    const ret = function (err, result) {\n      return typeof callback === 'function'\n        ? callback(err, result)\n        : err\n          ? reject(err)\n          : resolve(result)\n    }\n\n    req.end(function (err, result) {\n      var body\n\n      try {\n        body = JSONb.parse(result.text)\n      } catch (e) {\n        body = {}\n      }\n\n      if (err) {\n        const error = new Error()\n        error.ErrorMessage = body.ErrorMessage || err.message\n\n        error.statusCode = err.status || null\n        error.response = result || null\n        error.message = `Unsuccessful: Status Code: \"${error.statusCode}\" Message: \"${error.ErrorMessage}\"`\n\n        setValueIfExist(error, 'ErrorIdentifier', body.ErrorIdentifier)\n        setValueIfExist(error, 'ErrorCode', body.ErrorCode)\n        setValueIfExist(error, 'ErrorRelatedTo', body.ErrorRelatedTo)\n\n        return ret(error)\n      }\n\n      return ret(null, {\n        response: result,\n        body: body\n      })\n    })\n  })\n}\n\n/*\n *\n * MailjetResource constructor\n *\n * This class creates a function that can be build through method chaining\n *\n * @method {String} http method\n * @func {String} resource/path to be sent\n * @context {MailjetClient[instance]} parent client\n */\nfunction MailjetResource (method, func, options, context) {\n  this.base = func\n  this.callUrl = func\n  this.options = options || context.options\n\n  this.resource = func.toLowerCase()\n\n  this.lastAdded = RESOURCE\n  var self = context\n\n  /*\n  It can be REST or nothing if we only know the resource\n  */\n  this.subPath = (function () {\n    if (func.toLowerCase() !== 'send' && func.indexOf('sms') === -1) {\n      return 'REST'\n    }\n    return ''\n  })()\n\n  /**\n   *\n   * result.\n   *\n   * @params (optional) {Object Littteral} parameters to be sent to the server\n   * @callback (optional) {Function} called on response or error\n   */\n  var that = this\n  this.result = function (params, callback) {\n    params = params || {}\n    if (typeof params === 'function') {\n      callback = params\n      params = {}\n    }\n\n    /*\n    We build the querystring depending on the parameters. if the user explicitly mentionned\n    a filters property, we pass it to the url\n    */\n    var path = self.path(that.callUrl, that.subPath, (function () {\n      if (params.filters) {\n        var ret = params.filters\n        delete params.filters\n        return ret\n      } else if (method === 'get') {\n        return params\n      } else {\n        return {}\n      }\n    })(), that.options)\n\n    var perform_api_call = null\n    if (that.options && 'perform_api_call' in that.options) {\n      perform_api_call = that.options.perform_api_call\n    } else {\n      perform_api_call = self.config.perform_api_call\n    }\n\n    that.callUrl = that.base\n    self.lastAdded = RESOURCE\n    return self.httpRequest(method, 'https://' + path, params, callback, perform_api_call)\n  }\n}\n\n/**\n *\n * id.\n *\n * Add an ID and prevent invalid id chaining\n *\n * @value {String/Number} append an id to the path\n * @return the MailjetResource instance to allow method chaining\n *\n */\nMailjetResource.prototype.id = function (value) {\n  if (this.lastAdded === ID && DEBUG_MODE) {\n    console.warn('[WARNING] your request may fail due to invalid id chaining')\n  }\n\n  this.callUrl = _path.join(this.callUrl, value.toString())\n  this.lastAdded = ID\n  return this\n}\n\n/**\n *\n * action.\n *\n * Add an Action and prevent invalid action chaining\n *\n * @value {String} append an action to the path\n * @return the MailjetResource instance to allow method chaining\n *\n */\nMailjetResource.prototype.action = function (name) {\n  if (this.lastAdded === ACTION && DEBUG_MODE) {\n    console.warn('[WARNING] your request may fail due to invalid action chaining')\n  }\n\n  this.callUrl = _path.join(this.callUrl, name)\n  this.action = name.toLowerCase()\n\n  this.lastAdded = ACTION\n\n  if (this.action.toLowerCase() === 'csvdata') {\n    this.action = 'csvdata/text:plain'\n  } else if (this.action.toLowerCase() === 'csverror') {\n    this.action = 'csverror/text:csv'\n  }\n\n  var self = this\n  this.subPath = (function () {\n    if (self.resource === 'contactslist' && self.action === 'csvdata/text:plain' ||\n      self.resource === 'batchjob' && self.action === 'csverror/text:csv') {\n      return 'DATA'\n    } else {\n      return self.subPath\n    }\n  })()\n  return self\n}\n\n/**\n *\n * request.\n *\n * @parmas {Object literal} method parameters\n * @callback (optional) {Function} triggered when done\n *\n * @return {String} the server response\n */\n\nMailjetResource.prototype.request = function (params, callback) {\n  return this.result(params, callback).catch(function (err) {\n    try {\n      const ErrorDetails = JSON.parse(err.response.text);\n      const fullMessage = ErrorDetails.Messages[0].Errors[0].ErrorMessage;\n\n      if (typeof fullMessage === \"string\") {\n        err.message = err.message + \";\\n\" + fullMessage;\n        throw err;\n      }\n      throw err;\n    } catch {\n      throw err;\n    }\n  });\n};\n\n/*\n * post.\n *\n * @func {String} required Mailjet API function to be used (can contain a whole action path)\n *\n * @returns a function that make an httpRequest for each call\n */\nMailjetClient.prototype.post = function (func, options) {\n  return new MailjetResource('post', func, options, this)\n}\n\n/*\n * get.\n *\n * @func {String} required Mailjet API function to be used (can contain a whole action path)\n *\n * @returns a function that make an httpRequest for each call\n */\nMailjetClient.prototype.get = function (func, options) {\n  return new MailjetResource('get', func, options, this)\n}\n\n/*\n * delete.\n *\n * @func {String} required Mailjet API function to be used (can contain a whole action path)\n *\n * @returns a function that make an httpRequest for each call\n */\nMailjetClient.prototype.delete = function (func, options) {\n  return new MailjetResource('delete', func, options, this)\n}\n\n/*\n * put.\n *\n * @func {String} required Mailjet API function to be used (can contain a whole action path)\n *\n * @returns a function that make an httpRequest for each call\n */\nMailjetClient.prototype.put = function (func, options) {\n  return new MailjetResource('put', func, options, this)\n}\n\n/*\n * Exports the Mailjet client.\n *\n * you can require it like so:\n * var mj = require ('./mailjet-client')\n *\n * or for the bleeding edge developpers out there:\n * import mj from './mailjet-client'\n */\nmodule.exports = MailjetClient\n"]},"metadata":{},"sourceType":"script"}